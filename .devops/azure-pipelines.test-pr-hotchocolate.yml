trigger:
  branches:
    include:
      - main

pr:
  - main

stages:
  - stage: ubuntu
    displayName: "Ubuntu Latest"
    dependsOn: []
    pool:
      vmImage: "ubuntu-latest"
    jobs:
      - job: Test
        displayName: "Test"
        dependsOn: []
        continueOnError: true
        strategy:
          parallel: 3
        steps:
          - task: UseDotNet@2
            displayName: "Install .NET Core 2.1"
            inputs:
              packageType: 'sdk'
              version: '2.1.816'
              includePreviewVersions: true
          - task: UseDotNet@2
            displayName: "Install .NET Core 3.1"
            inputs:
              packageType: 'sdk'
              version: '3.1.409'
              includePreviewVersions: true
          - task: UseDotNet@2
            displayName: "Install .NET 5.0"
            inputs:
              packageType: 'sdk'
              version: '5.0.401'
              includePreviewVersions: true
          - task: UseDotNet@2
            displayName: "Install .NET 6.0"
            inputs:
              packageType: 'sdk'
              version: '6.0.100-rc.1.21458.32'
              includePreviewVersions: true
          - task: CmdLine@2
            displayName: "Run Tests"
            inputs:
              script: './build.cmd Test --skip --test-partition $(System.JobPositionInPhase)'
          - task: PublishBuildArtifacts@1
            displayName: "Upload Test Results"
            inputs:
              artifactName: test-results
              pathtoPublish: "output/test-results"
