"use strict";(self.webpackChunk_banana_cake_pop_main=self.webpackChunk_banana_cake_pop_main||[]).push([[9603],{69603:function(e,t,n){n.r(t),n.d(t,{default:function(){return ae}});var r=n(96234),a=n(17901),u=n(34795),s=n(77162),i=n.n(s),c=n(33028),o=n(59740),p=n(32502),d=n(99405),f=n(99579),h=n(41361),l=n(69621),v=n(27995);function b(e,t){return x.apply(this,arguments)}function x(){return(x=(0,u.Z)(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1,e.next=3,(0,v.X3)(t,n,{upgrade:function(e,t){r=0===t}});case 3:if(a=e.sent,!r){e.next=9;break}return a.close(),e.next=8,(0,v.Lj)(t);case 8:return e.abrupt("return",void 0);case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){var n=(0,f.zO)();return t?{created:n,message:e,details:t}:{created:n,message:e}}function k(e,t,n){return w.apply(this,arguments)}function w(){return(w=(0,u.Z)(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.push(m("Migration failed",r)),e.next=3,(0,d.XF)("update-log",(0,c.Z)((0,c.Z)({},t),{},{logs:n}));case 3:return e.abrupt("return","migration-failed");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return Z.apply(this,arguments)}function Z(){return(Z=(0,u.Z)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.push(m("Migration succeeded")),e.next=3,(0,d.XF)("update-log",(0,c.Z)((0,c.Z)({},t),{},{logs:n}));case 3:return e.abrupt("return","migrated");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,n,r,a){return E.apply(this,arguments)}function E(){return(E=(0,u.Z)(i().mark((function e(t,n,r,a,u){var s,o,p,d,f,v,b,x,k,w,g,Z,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new Set,e.prev=1,u.push(m('Starting entity "'.concat(r,'" migration...'))),o=t.transaction(r,"readonly"),p=!1,d=!1,e.prev=6,v=(0,l.Z)(o.store);case 8:return e.next=10,v.next();case 10:if(!(p=!(b=e.sent).done)){e.next=16;break}x=b.value,s.add(a(x.value));case 13:p=!1,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(6),d=!0,f=e.t0;case 22:if(e.prev=22,e.prev=23,!p||null==v.return){e.next=27;break}return e.next=27,v.return();case 27:if(e.prev=27,!d){e.next=30;break}throw f;case 30:return e.finish(27);case 31:return e.finish(22);case 32:return e.next=34,o.done;case 34:k=n.transaction(r,"readwrite"),w=[],g=(0,h.Z)(s);try{for(g.s();!(Z=g.n()).done;)y=Z.value,w.push(k.store.put(y))}catch(i){g.e(i)}finally{g.f()}return w.push(k.done),e.next=41,Promise.all(w);case 41:return u.push(m('Entity "'.concat(r,'" migration succeeded'))),e.abrupt("return",!0);case 45:return e.prev=45,e.t1=e.catch(1),u.push(m('Entity "'.concat(r,'" migration failed'),e.t1 instanceof Error?(0,c.Z)({},e.t1):void 0)),e.abrupt("return",!1);case 49:return e.prev=49,s.clear(),e.finish(49);case 52:case"end":return e.stop()}}),e,null,[[1,45,49,52],[6,18,22,32],[23,,27,31]])})))).apply(this,arguments)}var S=["openedPreviewDocuments"],D=["document"],C=["failed"],j="preview-14";function N(e){return A.apply(this,arguments)}function A(){return(A=(0,u.Z)(i().mark((function e(t){var n,r,a,u,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:j,created:(0,f.zO)(),fromVersion:"<= bcp-1.0.0-preview.14",toVersion:t,logs:[]},r=[],e.next=4,(0,d.bA)();case 4:return a=e.sent,e.next=7,a.count("app");case 7:if(e.t1=e.sent,e.t0=e.t1>0,!e.t0){e.next=14;break}return e.next=12,a.count("update-log");case 12:e.t2=e.sent,e.t0=e.t2>0;case 14:if(!e.t0){e.next=16;break}return e.abrupt("return","already-migrated");case 16:return e.prev=16,e.next=19,b("bcp-data-preview-1",1);case 19:return u=e.sent,e.next=22,b("bcp-state-preview-1",1);case 22:if(s=e.sent,!u||!s){e.next=50;break}return r.push(m("Starting migration...")),e.next=27,y(u,a,"document",F,r);case 27:if(e.sent){e.next=29;break}return e.abrupt("return",k(n,r));case 29:return e.next=31,y(u,a,"history",V,r);case 31:if(e.sent){e.next=33;break}return e.abrupt("return",k(n,r));case 33:return e.next=35,y(u,a,"node",G,r);case 35:if(e.sent){e.next=37;break}return e.abrupt("return",k(n,r));case 37:return e.next=39,y(u,a,"schema-query-result",M,r);case 39:if(e.sent){e.next=41;break}return e.abrupt("return",k(n,r));case 41:return e.next=43,I(s,a,r);case 43:if(e.sent){e.next=45;break}return e.abrupt("return",k(n,r));case 45:return e.next=47,g(n,r);case 47:return e.abrupt("return",e.sent);case 50:return e.abrupt("return","database-not-found");case 51:e.next=63;break;case 53:if(e.prev=53,e.t3=e.catch(16),!!(e.t3 instanceof Error&&"VersionError"===e.t3.name)){e.next=62;break}return e.next=59,k(n,r,e.t3 instanceof Error?(0,c.Z)({},e.t3):void 0);case 59:return e.abrupt("return",e.sent);case 62:return e.abrupt("return","database-higher-version");case 63:case"end":return e.stop()}}),e,null,[[16,53]])})))).apply(this,arguments)}function I(e,t,n){return _.apply(this,arguments)}function _(){return(_=(0,u.Z)(i().mark((function e(t,n,r){var a,u,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.push(m("Starting app state migration...")),e.next=4,t.get("state","state");case 4:if(a=e.sent){e.next=7;break}throw new Error("App state not found!");case 7:if(u=n.transaction(["app","document"],"readwrite"),!a.document.activeDocument){e.next=14;break}return e.next=11,u.objectStore("document").get(a.document.activeDocument.id);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=void 0;case 15:return s=e.t0,e.next=18,u.objectStore("app").put(O(a,null!==s&&void 0!==s?s:null),p.NY);case 18:return e.next=20,u.done;case 20:return r.push(m("App state migration succeeded")),e.abrupt("return",!0);case 24:return e.prev=24,e.t1=e.catch(0),r.push(m("App state migration failed",e.t1 instanceof Error?(0,c.Z)({},e.t1):void 0)),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[0,24]])})))).apply(this,arguments)}function O(e,t){var n,r,a=null!==(n=null===(r=e.tab.ids.map((function(t){return e.tab.entities[t]})).find((function(e){return!(null===e||void 0===e||!e.isPreview)})))||void 0===r?void 0:r.id)&&void 0!==n?n:null,u=e.document,s=(u.openedPreviewDocuments,(0,o.Z)(u,S)),i=(0,o.Z)(e,D);return(0,c.Z)((0,c.Z)({},i),{},{document:(0,c.Z)((0,c.Z)({},s),{},{activeDocument:t,openedPreviewDocument:a})})}function F(e){return(0,p.Fj)({id:e.id,name:e.name,operationName:e.operationName,body:e.graphQLDocument,variables:e.variables,hash:e.hash,isDraft:e.isDraft,isNew:e.isNew,activeConnectionKind:"http",httpConnection:{endpoint:e.schemaEndpoint,subscriptionEndpoint:e.subscriptionEndpoint,headers:P(e.httpHeaders),includeCookies:"include"===e.credentials,useGet:"GET"===e.httpMethod,useTunnel:!1}})}function P(e){if("string"!==typeof e)return e;try{var t=JSON.parse(e);return Object.keys(t).map((function(e){return{name:e,value:t[e],enabled:!0}}))}catch(n){return}}function V(e){var t=e.failed,n=(0,o.Z)(e,C);return(0,c.Z)((0,c.Z)({},n),{},{operationStatus:t?"failed":"succeeded"})}function G(e){var t;return(0,c.Z)((0,c.Z)({},e),{},{parentId:null!==(t=e.parentId)&&void 0!==t?t:e.workspaceId,path:e.path.slice(1)})}function M(e){return e}var T=["document"],q=["failed"],z="preview-15";function K(e){return L.apply(this,arguments)}function L(){return(L=(0,u.Z)(i().mark((function e(t){var n,r,a,u,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:z,created:(0,f.zO)(),fromVersion:">= bcp-1.0.0-preview.15 & <= bcp-1.0.0-preview.17",toVersion:t,logs:[]},r=[],e.next=4,(0,d.bA)();case 4:return a=e.sent,e.next=7,a.count("app");case 7:if(e.t1=e.sent,e.t0=e.t1>0,!e.t0){e.next=14;break}return e.next=12,a.count("update-log");case 12:e.t2=e.sent,e.t0=e.t2>0;case 14:if(!e.t0){e.next=16;break}return e.abrupt("return","already-migrated");case 16:return e.prev=16,e.next=19,b("bcp-data-preview-1",10);case 19:return u=e.sent,e.next=22,b("bcp-state-preview-1",5);case 22:if(s=e.sent,!u||!s){e.next=54;break}return r.push(m("Starting migration...")),e.next=27,y(u,a,"document",J,r);case 27:if(e.sent){e.next=29;break}return e.abrupt("return",k(n,r));case 29:return e.next=31,y(u,a,"history",Y,r);case 31:if(e.sent){e.next=33;break}return e.abrupt("return",k(n,r));case 33:return e.next=35,y(u,a,"node",B,r);case 35:if(e.sent){e.next=37;break}return e.abrupt("return",k(n,r));case 37:return e.next=39,y(u,a,"schema-query-result",R,r);case 39:if(e.sent){e.next=41;break}return e.abrupt("return",k(n,r));case 41:return e.next=43,W(u,r);case 43:if(e.sent){e.next=45;break}return e.abrupt("return",k(n,r));case 45:return e.next=47,Q(s,a,r);case 47:if(e.sent){e.next=49;break}return e.abrupt("return",k(n,r));case 49:return e.next=51,g(n,r);case 51:return e.abrupt("return",e.sent);case 54:return e.abrupt("return","database-not-found");case 55:e.next=67;break;case 57:if(e.prev=57,e.t3=e.catch(16),!!(e.t3 instanceof Error&&"VersionError"===e.t3.name)){e.next=66;break}return e.next=63,k(n,r,e.t3 instanceof Error?(0,c.Z)({},e.t3):void 0);case 63:return e.abrupt("return",e.sent);case 66:return e.abrupt("return","database-higher-version");case 67:case"end":return e.stop()}}),e,null,[[16,57]])})))).apply(this,arguments)}function Q(e,t,n){return X.apply(this,arguments)}function X(){return X=(0,u.Z)(i().mark((function e(t,n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.push(m("Starting app state migration...")),e.next=4,t.get("state","state");case 4:if(a=e.sent){e.next=7;break}throw new Error("App state not found!");case 7:if(s=n.transaction(["app","document","node"],"readwrite"),!a.document.activeDocument){e.next=14;break}return e.next=11,s.objectStore("document").get(a.document.activeDocument.id).then(function(){var e=(0,u.Z)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,s.objectStore("node").get(t.id);case 3:return n=e.sent,e.abrupt("return",(0,c.Z)((0,c.Z)({},t),{},{version:null===n||void 0===n?void 0:n.version}));case 5:return e.abrupt("return",void 0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=void 0;case 15:return o=e.t0,e.next=18,s.objectStore("app").put(H(a,null!==o&&void 0!==o?o:null),p.NY);case 18:return e.next=20,s.done;case 20:return r.push(m("App state migration succeeded")),e.abrupt("return",!0);case 24:return e.prev=24,e.t1=e.catch(0),r.push(m("App state migration failed",e.t1 instanceof Error?(0,c.Z)({},e.t1):void 0)),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[0,24]])}))),X.apply(this,arguments)}function H(e,t){var n=e.document,r=(0,o.Z)(e,T);return(0,c.Z)((0,c.Z)({},r),{},{document:(0,c.Z)((0,c.Z)({},n),{},{activeDocument:t,openedPreviewDocuments:void 0})})}function J(e){return"activeConnectionKind"in e?(0,p.Fj)((0,c.Z)((0,c.Z)({},e),{},{httpConnection:e.httpConnection?(0,c.Z)((0,c.Z)({},e.httpConnection),{},{headers:U(e.httpConnection.headers)}):e.httpConnection})):(0,p.Fj)({id:e.id,name:e.name,operationName:e.operationName,body:e.graphQLDocument,variables:e.variables,hash:e.hash,isDraft:e.isDraft,isNew:e.isNew,activeConnectionKind:"http",httpConnection:{endpoint:e.schemaEndpoint,subscriptionEndpoint:e.subscriptionEndpoint,headers:U(e.httpHeaders),includeCookies:"include"===e.credentials,useGet:"GET"===e.httpMethod,useTunnel:!1}})}function U(e){if(e){if("string"!==typeof e)return e.map((function(e){var t=e.name;return{name:null!==t&&void 0!==t?t:"",value:e.value,enabled:e.enabled}}));try{var t=JSON.parse(e);return Object.keys(t).map((function(e){return{name:e,value:t[e],enabled:!0}}))}catch(n){return}}}function Y(e){if("failed"in e){var t=e.failed,n=(0,o.Z)(e,q);return(0,c.Z)((0,c.Z)({},n),{},{operationStatus:t?"failed":"succeeded"})}return e}function B(e){var t;return(0,c.Z)((0,c.Z)({},e),{},{parentId:null!==(t=e.parentId)&&void 0!==t?t:e.workspaceId,path:e.path.length&&e.path[0]===e.workspaceId?e.path.slice(1):e.path})}function R(e){return e}function W(e,t){return $.apply(this,arguments)}function $(){return($=(0,u.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.push(m("Starting user session migration...")),e.next=4,t.get("user-session","session");case 4:if(!(r=e.sent)){e.next=8;break}return e.next=8,(0,p.Sm)(r);case 8:return n.push(m("User session migration succeeded")),e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(0),n.push(m("User session migration failed",e.t0 instanceof Error?(0,c.Z)({},e.t0):void 0)),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function ee(){return ee=(0,u.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t).then(function(){var e=(0,u.Z)(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("database-higher-version"!==n){e.next=3;break}return e.next=3,K(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}var te=n(20763),ne=n(59529),re=n(27778);var ae=function(e){var t=e.children,n=(0,te.useState)(!0),u=(0,r.Z)(n,2),s=u[0],i=u[1];return(0,te.useEffect)((function(){(function(e){return ee.apply(this,arguments)})(a.qI).then((function(){i(!1)}))}),[i]),s?(0,re.jsx)(ne.Q,{}):(0,re.jsx)(re.Fragment,{children:t})}}}]);