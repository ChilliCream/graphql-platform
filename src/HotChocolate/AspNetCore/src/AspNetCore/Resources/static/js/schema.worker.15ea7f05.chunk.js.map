{"version":3,"sources":["../../shared/dist/common/index.js","../../shared/dist/common/LogLevel.js","../../shared/dist/messaging/message.js","../../shared/dist/messaging/messages/index.js","../../shared/dist/messaging/index.js","../../shared/dist/utils/create-hash.js","../../shared/dist/utils/create-id.js","../../shared/dist/utils/is-operation-definition.js","../../shared/dist/utils/timestamp.js","../../schema/dist/utils/backoff.js","../../schema/dist/utils/get-operations.js","../../schema/dist/document-cache.js","../../schema/dist/worker-context.js","../../schema/dist/http-header-cache.js","../../schema/dist/db-wrapper.js","../../schema/dist/schema-cache.js","../../schema/dist/language-service.js","../../schema/dist/console-log-proxy.js","../../schema/dist/graphql-client.js","../../schema/dist/history-log-proxy.js","../../schema/dist/result-cache-proxy.js","../../schema/dist/variable-cache.js","../../schema/dist/query-and-mutation-execution-strategy.js","../../schema/dist/subscription-execution-strategy.js","../../schema/dist/operation-executer.js","../../schema/dist/utils/get-operation-type.js","../../schema/dist/schema-browser.js","../../schema/dist/schema-fetcher.js","../../schema/dist/message-handler-registry.js","../../schema/dist/schema.worker.js"],"names":["LogLevel","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","Message","properties","instance","Constructor","TypeError","_classCallCheck","this","id","createId","type","createdAt","now","payload","createHash","stream","MD5","_len","arguments","length","content","Array","_key","forEach","c","update","digest","prefix","concat","nanoid","isOperationDefinition","node","kind","diff","start","end","Error","Date","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","_defineProperties","target","props","i","descriptor","fibonacciSequence","Backoff","execute","protoProps","staticProps","onFinish","_this","fn","_ref","mark","_callee","delay","wrap","_context","prev","next","running","count","sent","stop","t0","console","Math","floor","random","timeout","self","setTimeout","args","apply","err","undefined","clearTimeout","prototype","getOperations","document","operations","definitions","definition","_definition$name","name","push","operation","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread","source","getOwnPropertyDescriptors","defineProperties","_slicedToArray","arr","isArray","_arrayWithHoles","Symbol","iterator","_arr","_n","_d","_e","_s","_i","_iterableToArrayLimit","o","minLen","_arrayLikeToArray","n","toString","call","slice","constructor","from","test","_unsupportedIterableToArray","_nonIterableRest","len","arr2","cache$","BehaviorSubject","registerDocumentCacheHandlers","registerServerHandler","_message","documentId","deleteFromCache","session","_ref7","_ref8","set","getDocument","WorkerContext","port","httpMethod","schemaEndpoint","initialize","session$","complete","subscriptions","subscription","unsubscribe","context","combineLatest","select","_ref2","pipe","map","_ref3","_ref4","distinctUntilChanged","_ref5","subscribe","_ref6","sendMessage","selector","message","postMessage","get","cache","registerHeaderCacheHandlers","headers","getHeaders","_asyncToGenerator","getSchema","_x4","_getSchema","_callee3","origin","db","_context3","open","abrupt","putSchema","_x5","_x6","_putSchema","_callee4","_context4","put","openDB","upgrade","database","createObjectStore","state","_x","endpoint","cachedRecord","persistedRecord","getSchemaFromDB","setCore","schema","hash","setSchema","_x2","_x3","_setSchema","_callee2","record","_context2","JSON","stringify","clientSchema","buildClientSchema","updateSchema","exists","hasMutationType","getMutationType","hasSubscriptionType","getSubscriptionType","types","registerLanguageServiceHandlers","_ref$payload","cursor","rawSuggestions","getAutocompleteSuggestions","label","detail","documentation","insertText","diagnostics","getDiagnostics","range","severity","toMarkerSeverity","startLineNumber","line","startColumn","character","endLineNumber","endColumn","_ref7$payload","getHoverInformation","schemaInfo","logError","details","otherTabId","tabId","level","logInfo","phase1","executeOperation","_executeOperation","options","result","_yield$parseAndCheckH","data","_response","response","fetchCore","Response","parseAndCheckHttpResponse","createHttpResponseError","createHttpResponse","parsedBody","mapHttpResponseHeaders","statusCode","status","statusText","input","create","fetchSchema","_fetchSchema","phaseOneResult","phaseOneResponse","features","phase2","phaseTwoResult","phaseTwoResponse","query","variables","operationName","determineSchemaFeatures","buildIntrospectionQuery","credentials","extensions","requestInit","referrerPolicy","useGET","uri","chosenURI","queryParams","addQueryParam","encodeURIComponent","print","fragment","preFragment","fragmentStart","indexOf","substr","queryParamsPrefix","join","rewriteURIForGET","fetch","method","createServerNetworkError","request","requestBody","body","text","bodyText","createServerError","bodyTextOrError","parse","e","parseError","createServerParseError","find","t","selectionSet","selections","directive","s","isRepeatable","createFieldNode","locations","addDirectiveFeatures","removeSubscriptionIfNotSupported","directives","fields","addHistoryItem","operationFailed","operationType","appendResultItem","registerVariableCacheHandlers","_ref2$payload","getVariables","QueryAndMutationExecutionStrategy","runningOperations","_documentId","executeCore","httpOptions","_executeCore","_result$response","failed","isExecuting","isSubscription","errors","duration","success","timestamp","SubscriptionExecutionStrategy","subscriptionEndpoint","replace","runningSubscriptions","getSchemaEndpoint","client","SubscriptionClient","lazy","onConnected","onError","raw","_error","queryAndMutationStrategy","subscriptionStrategy","strategies","Map","registerOperationExecuterHandlers","cancel","operationNodes","d","operationNode","getOperationType","strategy","registerSchemaBrowserHandlers","fetchFieldType","typeName","fieldName","fetchFieldTypes","fetchType","_x7","_x8","fetchRootTypes","getType","GraphQLInputObjectType","field","getFields","description","valueType","getSchemaValueType","defaultValue","GraphQLInterfaceType","GraphQLObjectType","_field","a","isDeprecated","deprecationReason","getSchemaFieldType","_fields","_loop","_fieldName","getSchemaFieldTypes","rootTypes","queryType","getQueryType","mutationType","subscriptionType","getSchemaType","getKind","GraphQLEnumType","GraphQLScalarType","GraphQLUnionType","GraphQLList","GraphQLNonNull","ofType","enumValues","interfaces","getValues","v","getPossibleTypes","getInterfaces","typeKind","getTypes","innerType","isList","isOptional","stateMap","registerSchemaFetcherHandlers","backoff","currentId","_fetch","getStateOrDefault","enableSchemaPolling","useGETForQueries","setState","startFetching","refetch","cachedSchema","startPolling","schemaPollingInterval","_fetchCore","requestId","currentRequestId","schemaOrError","isIntrospectionQuery","contextId","fetching","changes","newState","pollingInterval","window","contexts","serverHandlers","initializeSchemaWorker","onmessage","handler","handle","handleServerMessage","onconnect","ports"],"mappings":"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","file":"static/js/schema.worker.15ea7f05.chunk.js","sourcesContent":["export * from \"./GraphQLRequestInfo\";\nexport * from \"./HttpHeaders\";\nexport * from \"./HttpMethod\";\nexport * from \"./HttpRequest\";\nexport * from \"./HttpRequestCredentials\";\nexport * from \"./HttpResponse\";\nexport * from \"./LogLevel\";\nexport * from \"./InputResult\";\nexport * from \"./Operation\";\nexport * from \"./QueryAndMutationResult\";\nexport * from \"./SchemaBrowserTypes\";\nexport * from \"./ServerError\";\nexport * from \"./SubscriptionResult\";","export var LogLevel;\n\n(function (LogLevel) {\n  LogLevel[LogLevel[\"error\"] = 0] = \"error\";\n  LogLevel[LogLevel[\"warning\"] = 1] = \"warning\";\n  LogLevel[LogLevel[\"info\"] = 2] = \"info\";\n})(LogLevel || (LogLevel = {}));","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createId, now } from \"../utils\";\nexport var Message = function Message(properties) {\n  _classCallCheck(this, Message);\n\n  _defineProperty(this, \"id\", void 0);\n\n  _defineProperty(this, \"type\", void 0);\n\n  _defineProperty(this, \"createdAt\", void 0);\n\n  _defineProperty(this, \"payload\", void 0);\n\n  this.id = properties.id || createId();\n  this.type = properties.type;\n  this.createdAt = properties.createdAt || now();\n  this.payload = properties.payload;\n};","export * from \"./AppendResultMessage\";\nexport * from \"./BeginExecutionMessage\";\nexport * from \"./CompletionItemRequest\";\nexport * from \"./DocumentUpdate\";\nexport * from \"./HistoryMessage\";\nexport * from \"./HoverInformationRequest\";\nexport * from \"./LogMessage\";\nexport * from \"./OperationExecutionMessage\";\nexport * from \"./SchemaFieldRequest\";\nexport * from \"./SchemaInfo\";\nexport * from \"./Session\";\nexport * from \"./VariablesCacheItemExists\";\nexport * from \"./VariablesCacheItemToDelete\";\nexport * from \"./VariablesCacheItemToSet\";","export { Message } from \"./message\";\nexport { MessageType } from \"./message-type\";\nexport * from \"./messages\";","import MD5 from \"md5.js\";\nexport function createHash() {\n  var stream = new MD5();\n\n  for (var _len = arguments.length, content = new Array(_len), _key = 0; _key < _len; _key++) {\n    content[_key] = arguments[_key];\n  }\n\n  content.forEach(function (c) {\n    return stream = stream.update(c);\n  });\n  return stream.digest(\"hex\");\n}","import { nanoid } from \"nanoid\";\nexport function createId(prefix) {\n  return prefix && prefix.length > 0 ? \"\".concat(prefix, \"|\").concat(nanoid()) : nanoid();\n}","export function isOperationDefinition(node) {\n  return node.kind === \"OperationDefinition\";\n}","export function diff(start, end) {\n  if (start > end) {\n    throw new Error(\"'start' must be smaller than 'end'.\");\n  }\n\n  return end - start;\n}\nexport function now() {\n  return Date.now();\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar fibonacciSequence = [0, 1, 1, 2, 3, 5, 8, 13, 21, 34];\nvar maxExecutions = 10;\nexport var Backoff = /*#__PURE__*/function () {\n  function Backoff(execute) {\n    _classCallCheck(this, Backoff);\n\n    this.execute = execute;\n\n    _defineProperty(this, \"count\", 0);\n\n    _defineProperty(this, \"running\", false);\n\n    _defineProperty(this, \"timeout\", void 0);\n  }\n\n  _createClass(Backoff, [{\n    key: \"start\",\n    value: function start(onFinish) {\n      var _this = this;\n\n      var execute = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n          var delay;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _this.running = true;\n                  _context.prev = 1;\n                  _context.next = 4;\n                  return _this.execute(_this.count++);\n\n                case 4:\n                  if (!_context.sent) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  _this.stop();\n\n                  onFinish();\n\n                case 7:\n                  _context.next = 12;\n                  break;\n\n                case 9:\n                  _context.prev = 9;\n                  _context.t0 = _context[\"catch\"](1);\n                  console.error(_context.t0);\n\n                case 12:\n                  if (_this.running) {\n                    if (_this.count < maxExecutions) {\n                      delay = Math.floor(Math.random() * fibonacciSequence[_this.count] * 250);\n                      _this.timeout = self.setTimeout(execute, delay);\n                    } else {\n                      onFinish();\n                    }\n                  }\n\n                case 13:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[1, 9]]);\n        }));\n\n        return function execute() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      execute();\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      this.running = false;\n      self.clearTimeout(this.timeout);\n    }\n  }]);\n\n  return Backoff;\n}();","import { isOperationDefinition } from \"@bcp/shared/utils\";\nexport function getOperations(document) {\n  var operations = [];\n\n  if (document) {\n    document.definitions.forEach(function (definition) {\n      var _definition$name;\n\n      if (isOperationDefinition(definition) && ((_definition$name = definition.name) === null || _definition$name === void 0 ? void 0 : _definition$name.value)) {\n        operations.push({\n          name: definition.name.value,\n          type: definition.operation\n        });\n      }\n    });\n  }\n\n  return operations;\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport { Message } from \"@bcp/shared/messaging\";\nimport { BehaviorSubject, combineLatest } from \"rxjs\";\nimport { distinctUntilChanged, filter, map } from \"rxjs/operators\";\nimport { getOperations } from \"./utils\";\nimport { registerServerHandler } from \"./message-handler-registry\";\n// todo: LRU\nvar cache$ = new BehaviorSubject({});\nexport function registerDocumentCacheHandlers() {\n  registerDeleteReceiver();\n  registerSetReceiver();\n}\n\nfunction registerDeleteReceiver() {\n  registerServerHandler(\"document-cache-delete-item\", function (_message, _ref) {\n    var documentId = _ref.session.documentId;\n    deleteFromCache(documentId);\n  });\n}\n\nexport function registerOperationsChanged(context) {\n  ///  TODO: documentId\n  return combineLatest([context.select(function (_ref2) {\n    var documentId = _ref2.documentId;\n    return documentId;\n  }), cache$]).pipe(map(function (_ref3) {\n    var _ref4 = _slicedToArray(_ref3, 2),\n        documentId = _ref4[0],\n        cache = _ref4[1];\n\n    return {\n      documentId: documentId,\n      document: cache[documentId]\n    };\n  }), distinctUntilChanged(), filter(function (_ref5) {\n    var document = _ref5.document,\n        documentId = _ref5.documentId;\n    return !!document && documentId !== \"\";\n  })).subscribe(function (_ref6) {\n    var document = _ref6.document;\n    context.sendMessage(new Message({\n      type: \"document-operations-update\",\n      payload: getOperations(document)\n    }));\n  });\n}\n\nfunction registerSetReceiver() {\n  registerServerHandler(\"document-cache-set-item\", function (_ref7, _ref8) {\n    var payload = _ref7.payload;\n    var documentId = _ref8.session.documentId;\n    set(documentId, payload);\n  });\n}\n\nfunction deleteFromCache(documentId) {\n  cache$.next(_objectSpread(_objectSpread({}, cache$.value), {}, _defineProperty({}, documentId, undefined)));\n}\n\nexport function getDocument(documentId) {\n  return cache$.value[documentId];\n}\n\nfunction set(documentId, document) {\n  cache$.next(_objectSpread(_objectSpread({}, cache$.value), {}, _defineProperty({}, documentId, document)));\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createId } from \"@bcp/shared/utils\";\nimport { BehaviorSubject } from \"rxjs\";\nimport { distinctUntilChanged, map } from \"rxjs/operators\";\nimport { registerOperationsChanged } from \"./document-cache\";\nimport { registerServerHandler } from \"./message-handler-registry\";\nexport var WorkerContext = /*#__PURE__*/function () {\n  function WorkerContext(port) {\n    _classCallCheck(this, WorkerContext);\n\n    this.port = port;\n\n    _defineProperty(this, \"id\", createId(\"context\"));\n\n    _defineProperty(this, \"session$\", new BehaviorSubject({\n      documentId: \"\",\n      httpMethod: \"POST\",\n      schemaEndpoint: \"\"\n    }));\n\n    _defineProperty(this, \"subscriptions\", []);\n\n    this.initialize();\n  }\n\n  _createClass(WorkerContext, [{\n    key: \"dispose\",\n    value: function dispose() {\n      this.session$.complete();\n      this.subscriptions.forEach(function (subscription) {\n        return subscription.unsubscribe();\n      });\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this = this;\n\n      registerServerHandler(\"set-session\", function (_ref) {\n        var payload = _ref.payload;\n\n        _this.session$.next(_objectSpread({}, payload));\n      });\n      this.subscriptions.push(registerOperationsChanged(this));\n    }\n  }, {\n    key: \"select\",\n    value: function select(selector) {\n      return this.session$.pipe(map(selector), distinctUntilChanged());\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage(message) {\n      this.port.postMessage(message);\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this.session$.value;\n    }\n  }]);\n\n  return WorkerContext;\n}();","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { registerServerHandler } from \"./message-handler-registry\";\n// todo: LRU\nvar cache = {};\nexport function registerHeaderCacheHandlers() {\n  registerDeleteReceiver();\n  registerSetReceiver();\n}\n\nfunction registerDeleteReceiver() {\n  registerServerHandler(\"http-headers-cache-delete-item\", function (_message, _ref) {\n    var documentId = _ref.session.documentId;\n    deleteFromCache(documentId);\n  });\n}\n\nfunction registerSetReceiver() {\n  registerServerHandler(\"http-headers-cache-set-item\", function (_ref2, _ref3) {\n    var headers = _ref2.payload;\n    var documentId = _ref3.session.documentId;\n    set(documentId, headers);\n  });\n}\n\nfunction deleteFromCache(documentId) {\n  cache = _objectSpread(_objectSpread({}, cache), {}, _defineProperty({}, documentId, undefined));\n}\n\nexport function getHeaders(documentId) {\n  return cache[documentId];\n}\n\nfunction set(documentId, headers) {\n  cache = _objectSpread(_objectSpread({}, cache), {}, _defineProperty({}, documentId, headers));\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { openDB } from \"idb\";\nexport function getDocument(_x) {\n  return _getDocument.apply(this, arguments);\n}\n\nfunction _getDocument() {\n  _getDocument = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(id) {\n    var db;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return open();\n\n          case 2:\n            db = _context.sent;\n            _context.next = 5;\n            return db.get(\"document\", id);\n\n          case 5:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getDocument.apply(this, arguments);\n}\n\nexport function putDocument(_x2, _x3) {\n  return _putDocument.apply(this, arguments);\n}\n\nfunction _putDocument() {\n  _putDocument = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(id, value) {\n    var db;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return open();\n\n          case 2:\n            db = _context2.sent;\n            _context2.next = 5;\n            return db.put(\"document\", value, id);\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _putDocument.apply(this, arguments);\n}\n\nexport function getSchema(_x4) {\n  return _getSchema.apply(this, arguments);\n}\n\nfunction _getSchema() {\n  _getSchema = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(origin) {\n    var db;\n    return regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return open();\n\n          case 2:\n            db = _context3.sent;\n            _context3.next = 5;\n            return db.get(\"schema\", origin);\n\n          case 5:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _getSchema.apply(this, arguments);\n}\n\nexport function putSchema(_x5, _x6) {\n  return _putSchema.apply(this, arguments);\n}\n\nfunction _putSchema() {\n  _putSchema = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(origin, value) {\n    var db;\n    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return open();\n\n          case 2:\n            db = _context4.sent;\n            _context4.next = 5;\n            return db.put(\"schema\", value, origin);\n\n          case 5:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _putSchema.apply(this, arguments);\n}\n\nfunction open() {\n  return openDB(\"bcp-schema\", 1, {\n    upgrade: function upgrade(database) {\n      database.createObjectStore(\"document\");\n      database.createObjectStore(\"schema\");\n    }\n  });\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { createHash } from \"@bcp/shared/utils\";\nimport { buildClientSchema } from \"graphql\";\nimport { getSchema as getSchemaFromDB, putSchema } from \"./db-wrapper\";\nimport { updateSchema } from \"./language-service\";\n// todo: LRU\nvar state = {};\nexport function getSchema(_x) {\n  return _getSchema.apply(this, arguments);\n}\n\nfunction _getSchema() {\n  _getSchema = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(context) {\n    var endpoint, cachedRecord, persistedRecord;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            endpoint = context.session.schemaEndpoint;\n            cachedRecord = state[endpoint];\n\n            if (!cachedRecord) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\", cachedRecord);\n\n          case 4:\n            _context.next = 6;\n            return getSchemaFromDB(endpoint);\n\n          case 6:\n            persistedRecord = _context.sent;\n\n            if (persistedRecord) {\n              setCore(context, endpoint, persistedRecord.schema, persistedRecord.hash);\n            }\n\n            return _context.abrupt(\"return\", state[endpoint]);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getSchema.apply(this, arguments);\n}\n\nexport function setSchema(_x2, _x3) {\n  return _setSchema.apply(this, arguments);\n}\n\nfunction _setSchema() {\n  _setSchema = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(context, schema) {\n    var endpoint, record, hash;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            endpoint = context.session.schemaEndpoint;\n            _context2.next = 3;\n            return getSchema(context);\n\n          case 3:\n            record = _context2.sent;\n            hash = createHash(JSON.stringify(schema));\n\n            if (!(!record || record.hash !== hash)) {\n              _context2.next = 9;\n              break;\n            }\n\n            setCore(context, endpoint, schema, hash);\n            _context2.next = 9;\n            return putSchema(endpoint, {\n              hash: hash,\n              schema: schema\n            });\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _setSchema.apply(this, arguments);\n}\n\nfunction setCore(context, endpoint, schema, hash) {\n  var clientSchema = buildClientSchema(schema);\n  updateSchema(context, {\n    endpoint: endpoint,\n    exists: true,\n    hash: hash,\n    hasMutationType: !!clientSchema.getMutationType(),\n    hasSubscriptionType: !!clientSchema.getSubscriptionType()\n  });\n  state = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, endpoint, {\n    hash: hash,\n    schema: clientSchema\n  }));\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { Message } from \"@bcp/shared/messaging\";\nimport { getAutocompleteSuggestions, getDiagnostics, getHoverInformation } from \"graphql-language-service-interface\";\nimport { registerServerHandler } from \"./message-handler-registry\";\nimport { getSchema } from \"./schema-cache\";\nvar types = {\n  \"GraphQL: Validation\": \"validation\",\n  \"GraphQL: Deprecation\": \"deprecation\",\n  \"GraphQL: Syntax\": \"syntax\"\n};\nexport function registerLanguageServiceHandlers() {\n  registerCompletionItemReceiver();\n  registerDiagnosticsReceiver();\n  registerHoverInformationReceiver();\n}\n\nfunction registerCompletionItemReceiver() {\n  registerServerHandler(\"auto-suggestions\", /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(_ref, context) {\n      var id, _ref$payload, content, cursor, type, record, payload, rawSuggestions;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              id = _ref.id, _ref$payload = _ref.payload, content = _ref$payload.content, cursor = _ref$payload.cursor, type = _ref.type;\n              _context.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context.sent;\n              payload = [];\n\n              if (record) {\n                rawSuggestions = getAutocompleteSuggestions(record.schema, content, cursor);\n                payload = rawSuggestions.map(function (_ref3) {\n                  var label = _ref3.label,\n                      kind = _ref3.kind,\n                      detail = _ref3.detail,\n                      documentation = _ref3.documentation;\n                  return {\n                    label: label,\n                    kind: kind,\n                    detail: detail,\n                    documentation: documentation,\n                    insertText: label\n                  };\n                });\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n}\n\nfunction registerDiagnosticsReceiver() {\n  registerServerHandler(\"diagnostics\", /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(_ref4, context) {\n      var id, document, type, record, diagnostics, payload;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              id = _ref4.id, document = _ref4.payload, type = _ref4.type;\n              _context2.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context2.sent;\n              diagnostics = getDiagnostics(document || \"\", record ? record.schema : undefined);\n              payload = diagnostics.map(function (_ref6) {\n                var message = _ref6.message,\n                    range = _ref6.range,\n                    severity = _ref6.severity,\n                    source = _ref6.source;\n                return {\n                  message: message,\n                  severity: severity ? toMarkerSeverity(severity) : 1,\n                  source: source ? types[source] : undefined,\n                  startLineNumber: range.start.line + 1,\n                  startColumn: range.start.character + 1,\n                  endLineNumber: range.end.line + 1,\n                  endColumn: range.end.character + 1\n                };\n              });\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x3, _x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }());\n}\n\nfunction registerHoverInformationReceiver() {\n  registerServerHandler(\"hover-information\", /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(_ref7, context) {\n      var id, _ref7$payload, content, cursor, type, record, payload;\n\n      return regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              id = _ref7.id, _ref7$payload = _ref7.payload, content = _ref7$payload.content, cursor = _ref7$payload.cursor, type = _ref7.type;\n              _context3.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context3.sent;\n              payload = undefined;\n\n              if (record) {\n                payload = getHoverInformation(record.schema, content, cursor);\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x5, _x6) {\n      return _ref8.apply(this, arguments);\n    };\n  }());\n}\n\nfunction toMarkerSeverity(severity) {\n  return [8, 4, 2, 1][severity - 1];\n}\n\nexport function updateSchema(context, schemaInfo) {\n  context.sendMessage(new Message({\n    type: \"schema-update\",\n    payload: schemaInfo\n  }));\n}","import { LogLevel } from \"@bcp/shared/common\";\nimport { Message } from \"@bcp/shared/messaging\";\nexport function logError(context, message, details, otherTabId) {\n  var tabId = otherTabId || context.session.documentId;\n  context.sendMessage(new Message({\n    type: \"log\",\n    payload: {\n      tabId: tabId,\n      level: LogLevel.error,\n      message: message,\n      details: details\n    }\n  }));\n}\nexport function logInfo(context, message, details, otherTabId) {\n  var tabId = otherTabId || context.session.documentId;\n  context.sendMessage(new Message({\n    type: \"log\",\n    payload: {\n      tabId: tabId,\n      level: LogLevel.info,\n      message: message,\n      details: details\n    }\n  }));\n}\nexport function logWarning(context, message, details, otherTabId) {\n  var tabId = otherTabId || context.session.documentId;\n  context.sendMessage(new Message({\n    type: \"log\",\n    payload: {\n      tabId: tabId,\n      level: LogLevel.warning,\n      message: message,\n      details: details\n    }\n  }));\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport \"whatwg-fetch\";\nimport { print } from \"graphql\";\nvar phase1 = {\n  \"kind\": \"Document\",\n  \"definitions\": [{\n    \"kind\": \"OperationDefinition\",\n    \"operation\": \"query\",\n    \"name\": {\n      \"kind\": \"Name\",\n      \"value\": \"introspection_phase_1\"\n    },\n    \"variableDefinitions\": [],\n    \"directives\": [],\n    \"selectionSet\": {\n      \"kind\": \"SelectionSet\",\n      \"selections\": [{\n        \"kind\": \"Field\",\n        \"alias\": {\n          \"kind\": \"Name\",\n          \"value\": \"schema\"\n        },\n        \"name\": {\n          \"kind\": \"Name\",\n          \"value\": \"__type\"\n        },\n        \"arguments\": [{\n          \"kind\": \"Argument\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"name\"\n          },\n          \"value\": {\n            \"kind\": \"StringValue\",\n            \"value\": \"__Schema\",\n            \"block\": false\n          }\n        }],\n        \"directives\": [],\n        \"selectionSet\": {\n          \"kind\": \"SelectionSet\",\n          \"selections\": [{\n            \"kind\": \"Field\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"name\"\n            },\n            \"arguments\": [],\n            \"directives\": []\n          }, {\n            \"kind\": \"Field\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"fields\"\n            },\n            \"arguments\": [],\n            \"directives\": [],\n            \"selectionSet\": {\n              \"kind\": \"SelectionSet\",\n              \"selections\": [{\n                \"kind\": \"Field\",\n                \"name\": {\n                  \"kind\": \"Name\",\n                  \"value\": \"name\"\n                },\n                \"arguments\": [],\n                \"directives\": []\n              }]\n            }\n          }]\n        }\n      }, {\n        \"kind\": \"Field\",\n        \"alias\": {\n          \"kind\": \"Name\",\n          \"value\": \"directive\"\n        },\n        \"name\": {\n          \"kind\": \"Name\",\n          \"value\": \"__type\"\n        },\n        \"arguments\": [{\n          \"kind\": \"Argument\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"name\"\n          },\n          \"value\": {\n            \"kind\": \"StringValue\",\n            \"value\": \"__Directive\",\n            \"block\": false\n          }\n        }],\n        \"directives\": [],\n        \"selectionSet\": {\n          \"kind\": \"SelectionSet\",\n          \"selections\": [{\n            \"kind\": \"Field\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"name\"\n            },\n            \"arguments\": [],\n            \"directives\": []\n          }, {\n            \"kind\": \"Field\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"fields\"\n            },\n            \"arguments\": [],\n            \"directives\": [],\n            \"selectionSet\": {\n              \"kind\": \"SelectionSet\",\n              \"selections\": [{\n                \"kind\": \"Field\",\n                \"name\": {\n                  \"kind\": \"Name\",\n                  \"value\": \"name\"\n                },\n                \"arguments\": [],\n                \"directives\": []\n              }]\n            }\n          }]\n        }\n      }]\n    }\n  }],\n  \"loc\": {\n    \"start\": 0,\n    \"end\": 199,\n    \"source\": {\n      \"body\": \"query introspection_phase_1 {\\n  schema: __type(name: \\\"__Schema\\\") {\\n    name\\n    fields {\\n      name\\n    }\\n  }\\n\\n  directive: __type(name: \\\"__Directive\\\") {\\n    name\\n    fields {\\n      name\\n    }\\n  }\\n}\\n\",\n      \"name\": \"GraphQL request\",\n      \"locationOffset\": {\n        \"line\": 1,\n        \"column\": 1\n      }\n    }\n  }\n};\nexport function executeOperation(_x, _x2) {\n  return _executeOperation.apply(this, arguments);\n}\n\nfunction _executeOperation() {\n  _executeOperation = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(options, operation) {\n    var result, _yield$parseAndCheckH, data, error, _response, response;\n\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return fetchCore(options, operation);\n\n          case 2:\n            result = _context.sent;\n\n            if (result.response instanceof Response) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, result), {}, {\n              response: {\n                error: result.response\n              }\n            }));\n\n          case 5:\n            _context.next = 7;\n            return parseAndCheckHttpResponse(result.response);\n\n          case 7:\n            _yield$parseAndCheckH = _context.sent;\n            data = _yield$parseAndCheckH.data;\n            error = _yield$parseAndCheckH.error;\n\n            if (!error) {\n              _context.next = 13;\n              break;\n            }\n\n            _response = createHttpResponseError(error, result.response);\n            return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, result), {}, {\n              response: _response\n            }));\n\n          case 13:\n            response = createHttpResponse(data, result.response);\n            return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, result), {}, {\n              response: response\n            }));\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _executeOperation.apply(this, arguments);\n}\n\nfunction createHttpResponse(parsedBody, response) {\n  var headers = mapHttpResponseHeaders(response.headers);\n  var result = {\n    parsedBody: parsedBody,\n    headers: headers,\n    statusCode: response.status,\n    statusText: response.statusText\n  };\n  return result;\n}\n\nfunction createHttpResponseError(error, response) {\n  var headers = mapHttpResponseHeaders(response.headers);\n  var result = {\n    error: error,\n    headers: headers,\n    statusCode: response.status,\n    statusText: response.statusText\n  };\n  return result;\n}\n\nfunction mapHttpResponseHeaders(input) {\n  var headers = Object.create(null);\n  input.forEach(function (value, key) {\n    headers[key] = value;\n  });\n  return headers;\n}\n\nexport function fetchSchema(_x3) {\n  return _fetchSchema.apply(this, arguments);\n}\n\nfunction _fetchSchema() {\n  _fetchSchema = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(options) {\n    var phaseOneResult, phaseOneResponse, features, phase2, phaseTwoResult, phaseTwoResponse;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return fetchCore(options, {\n              query: phase1,\n              variables: {},\n              operationName: \"introspection_phase_1\"\n            });\n\n          case 2:\n            phaseOneResult = _context2.sent;\n\n            if (phaseOneResult.response instanceof Response) {\n              _context2.next = 5;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", phaseOneResult.response);\n\n          case 5:\n            _context2.next = 7;\n            return parseAndCheckHttpResponse(phaseOneResult.response);\n\n          case 7:\n            phaseOneResponse = _context2.sent;\n\n            if (!phaseOneResponse.error) {\n              _context2.next = 10;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", phaseOneResponse.error);\n\n          case 10:\n            features = determineSchemaFeatures(phaseOneResponse.data.data);\n            phase2 = buildIntrospectionQuery(features);\n            _context2.next = 14;\n            return fetchCore(options, {\n              query: phase2,\n              variables: {},\n              operationName: \"introspection_phase_2\"\n            });\n\n          case 14:\n            phaseTwoResult = _context2.sent;\n\n            if (phaseTwoResult.response instanceof Response) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", phaseTwoResult.response);\n\n          case 17:\n            _context2.next = 19;\n            return parseAndCheckHttpResponse(phaseTwoResult.response);\n\n          case 19:\n            phaseTwoResponse = _context2.sent;\n\n            if (!phaseTwoResponse.error) {\n              _context2.next = 22;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", phaseTwoResponse.error);\n\n          case 22:\n            return _context2.abrupt(\"return\", phaseTwoResponse.data.data);\n\n          case 23:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _fetchSchema.apply(this, arguments);\n}\n\nfunction fetchCore(options, operation) {\n  var credentials = options.credentials || \"omit\";\n  var extensions = operation.extensions,\n      operationName = operation.operationName,\n      variables = operation.variables;\n  var requestInit = {\n    cache: \"no-cache\",\n    credentials: credentials,\n    referrerPolicy: \"no-referrer\"\n  }; // TODO: check get request URI length;\n  // if it's to long switch to POST\n\n  if (options.useGET) {\n    var uri = rewriteURIForGET(options.uri, operation);\n    return self.fetch(uri, _objectSpread(_objectSpread({}, requestInit), {}, {\n      method: \"GET\",\n      headers: options.headers\n    }))[\"catch\"](function (error) {\n      if (error instanceof TypeError) {\n        return createServerNetworkError(\"Server Not Reachable\", error.message);\n      }\n\n      return createServerNetworkError(\"Server Not Reachable\");\n    }).then(function (response) {\n      var request = {\n        uri: uri,\n        method: \"GET\",\n        credentials: options.credentials,\n        cache: \"no-cache\",\n        referrerPolicy: \"no-referrer\",\n        headers: options.headers\n      };\n      return {\n        request: request,\n        response: response\n      };\n    });\n  } else {\n    var requestBody = {\n      extensions: extensions,\n      operationName: operationName,\n      query: print(operation.query),\n      variables: variables\n    };\n    var body = JSON.stringify(requestBody);\n    return self.fetch(options.uri, _objectSpread(_objectSpread({}, requestInit), {}, {\n      method: \"POST\",\n      headers: _objectSpread(_objectSpread({}, options.headers), {}, {\n        \"Content-Type\": \"application/json\"\n      }),\n      body: body\n    }))[\"catch\"](function (error) {\n      if (error instanceof TypeError) {\n        return createServerNetworkError(\"Server Not Reachable\", error.message);\n      }\n\n      return createServerNetworkError(\"Server Not Reachable\");\n    }).then(function (response) {\n      var request = {\n        uri: options.uri,\n        method: \"POST\",\n        credentials: options.credentials,\n        cache: \"no-cache\",\n        referrerPolicy: \"no-referrer\",\n        headers: _objectSpread(_objectSpread({}, options.headers), {}, {\n          \"Content-Type\": \"application/json\"\n        }),\n        body: requestBody\n      };\n      return {\n        request: request,\n        response: response\n      };\n    });\n  }\n}\n\nfunction parseAndCheckHttpResponse(response) {\n  return response.text().then(function (bodyText) {\n    if (response.status >= 300) {\n      return createServerError(response, bodyText, \"Response not successful: Received status code \".concat(response.status));\n    }\n\n    return bodyText;\n  }).then(function (bodyTextOrError) {\n    if (typeof bodyTextOrError === \"string\") {\n      try {\n        var data = JSON.parse(bodyTextOrError);\n        return {\n          data: data\n        };\n      } catch (e) {\n        var error = createServerParseError(response, e, bodyTextOrError);\n        return {\n          error: error\n        };\n      }\n    } else {\n      return {\n        error: bodyTextOrError\n      };\n    }\n  });\n}\n\nfunction rewriteURIForGET(chosenURI, operation) {\n  // Implement the standard HTTP GET serialization, plus 'extensions'. Note\n  // the extra level of JSON serialization!\n  var queryParams = [];\n\n  var addQueryParam = function addQueryParam(key, value) {\n    queryParams.push(\"\".concat(key, \"=\").concat(encodeURIComponent(value)));\n  };\n\n  if (operation.query) {\n    addQueryParam(\"query\", print(operation.query));\n  }\n\n  if (operation.operationName) {\n    addQueryParam(\"operationName\", operation.operationName);\n  }\n\n  if (operation.variables) {\n    addQueryParam(\"variables\", JSON.stringify(operation.variables));\n  }\n\n  if (operation.extensions) {\n    addQueryParam(\"extensions\", JSON.stringify(operation.extensions));\n  } // Reconstruct the URI with added query params.\n  // XXX This assumes that the URI is well-formed and that it doesn't\n  //     already contain any of these query params. We could instead use the\n  //     URL API and take a polyfill (whatwg-url@6) for older browsers that\n  //     don't support URLSearchParams. Note that some browsers (and\n  //     versions of whatwg-url) support URL but not URLSearchParams!\n\n\n  var fragment = \"\";\n  var preFragment = chosenURI;\n  var fragmentStart = chosenURI.indexOf(\"#\");\n\n  if (fragmentStart !== -1) {\n    fragment = chosenURI.substr(fragmentStart);\n    preFragment = chosenURI.substr(0, fragmentStart);\n  }\n\n  var queryParamsPrefix = preFragment.indexOf(\"?\") === -1 ? \"?\" : \"&\";\n  var newURI = preFragment + queryParamsPrefix + queryParams.join(\"&\") + fragment;\n  return newURI;\n}\n\nfunction createServerError(response, bodyText, message) {\n  var error = new Error(message);\n  error.name = \"ServerError\";\n  error.statusCode = response.status;\n  error.statusText = response.statusText;\n  error.bodyText = bodyText;\n  return error;\n}\n\nfunction createServerNetworkError(message, statusText) {\n  var error = new Error(message);\n  error.name = \"ServerNetworkError\";\n  error.statusText = statusText;\n  return error;\n}\n\nfunction createServerParseError(response, error, bodyText) {\n  var parseError = error;\n  parseError.name = \"ServerParseError\";\n  parseError.statusCode = response.status;\n  parseError.statusText = response.statusText;\n  parseError.bodyText = bodyText;\n  return parseError;\n}\n\nfunction buildIntrospectionQuery(features) {\n  var phase2 = {\n    \"kind\": \"Document\",\n    \"definitions\": [{\n      \"kind\": \"OperationDefinition\",\n      \"operation\": \"query\",\n      \"name\": {\n        \"kind\": \"Name\",\n        \"value\": \"introspection_phase_2\"\n      },\n      \"variableDefinitions\": [],\n      \"directives\": [],\n      \"selectionSet\": {\n        \"kind\": \"SelectionSet\",\n        \"selections\": [{\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"__schema\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"queryType\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"name\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"mutationType\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"name\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"subscriptionType\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"name\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"types\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"FragmentSpread\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"FullType\"\n                  },\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"directives\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"name\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }, {\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"description\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }, {\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"args\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": [],\n                  \"selectionSet\": {\n                    \"kind\": \"SelectionSet\",\n                    \"selections\": [{\n                      \"kind\": \"FragmentSpread\",\n                      \"name\": {\n                        \"kind\": \"Name\",\n                        \"value\": \"InputValue\"\n                      },\n                      \"directives\": []\n                    }]\n                  }\n                }]\n              }\n            }]\n          }\n        }]\n      }\n    }, {\n      \"kind\": \"FragmentDefinition\",\n      \"name\": {\n        \"kind\": \"Name\",\n        \"value\": \"FullType\"\n      },\n      \"typeCondition\": {\n        \"kind\": \"NamedType\",\n        \"name\": {\n          \"kind\": \"Name\",\n          \"value\": \"__Type\"\n        }\n      },\n      \"directives\": [],\n      \"selectionSet\": {\n        \"kind\": \"SelectionSet\",\n        \"selections\": [{\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"kind\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"name\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"description\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"fields\"\n          },\n          \"arguments\": [{\n            \"kind\": \"Argument\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"includeDeprecated\"\n            },\n            \"value\": {\n              \"kind\": \"BooleanValue\",\n              \"value\": true\n            }\n          }],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"name\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"description\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"args\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"FragmentSpread\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"InputValue\"\n                  },\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"type\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"FragmentSpread\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"TypeRef\"\n                  },\n                  \"directives\": []\n                }]\n              }\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"isDeprecated\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"deprecationReason\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }]\n          }\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"inputFields\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"FragmentSpread\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"InputValue\"\n              },\n              \"directives\": []\n            }]\n          }\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"interfaces\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"FragmentSpread\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"TypeRef\"\n              },\n              \"directives\": []\n            }]\n          }\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"enumValues\"\n          },\n          \"arguments\": [{\n            \"kind\": \"Argument\",\n            \"name\": {\n              \"kind\": \"Name\",\n              \"value\": \"includeDeprecated\"\n            },\n            \"value\": {\n              \"kind\": \"BooleanValue\",\n              \"value\": true\n            }\n          }],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"name\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"description\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"isDeprecated\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"deprecationReason\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }]\n          }\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"possibleTypes\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"FragmentSpread\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"TypeRef\"\n              },\n              \"directives\": []\n            }]\n          }\n        }]\n      }\n    }, {\n      \"kind\": \"FragmentDefinition\",\n      \"name\": {\n        \"kind\": \"Name\",\n        \"value\": \"InputValue\"\n      },\n      \"typeCondition\": {\n        \"kind\": \"NamedType\",\n        \"name\": {\n          \"kind\": \"Name\",\n          \"value\": \"__InputValue\"\n        }\n      },\n      \"directives\": [],\n      \"selectionSet\": {\n        \"kind\": \"SelectionSet\",\n        \"selections\": [{\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"name\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"description\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"type\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"FragmentSpread\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"TypeRef\"\n              },\n              \"directives\": []\n            }]\n          }\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"defaultValue\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }]\n      }\n    }, {\n      \"kind\": \"FragmentDefinition\",\n      \"name\": {\n        \"kind\": \"Name\",\n        \"value\": \"TypeRef\"\n      },\n      \"typeCondition\": {\n        \"kind\": \"NamedType\",\n        \"name\": {\n          \"kind\": \"Name\",\n          \"value\": \"__Type\"\n        }\n      },\n      \"directives\": [],\n      \"selectionSet\": {\n        \"kind\": \"SelectionSet\",\n        \"selections\": [{\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"kind\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"name\"\n          },\n          \"arguments\": [],\n          \"directives\": []\n        }, {\n          \"kind\": \"Field\",\n          \"name\": {\n            \"kind\": \"Name\",\n            \"value\": \"ofType\"\n          },\n          \"arguments\": [],\n          \"directives\": [],\n          \"selectionSet\": {\n            \"kind\": \"SelectionSet\",\n            \"selections\": [{\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"kind\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"name\"\n              },\n              \"arguments\": [],\n              \"directives\": []\n            }, {\n              \"kind\": \"Field\",\n              \"name\": {\n                \"kind\": \"Name\",\n                \"value\": \"ofType\"\n              },\n              \"arguments\": [],\n              \"directives\": [],\n              \"selectionSet\": {\n                \"kind\": \"SelectionSet\",\n                \"selections\": [{\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"kind\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }, {\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"name\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": []\n                }, {\n                  \"kind\": \"Field\",\n                  \"name\": {\n                    \"kind\": \"Name\",\n                    \"value\": \"ofType\"\n                  },\n                  \"arguments\": [],\n                  \"directives\": [],\n                  \"selectionSet\": {\n                    \"kind\": \"SelectionSet\",\n                    \"selections\": [{\n                      \"kind\": \"Field\",\n                      \"name\": {\n                        \"kind\": \"Name\",\n                        \"value\": \"kind\"\n                      },\n                      \"arguments\": [],\n                      \"directives\": []\n                    }, {\n                      \"kind\": \"Field\",\n                      \"name\": {\n                        \"kind\": \"Name\",\n                        \"value\": \"name\"\n                      },\n                      \"arguments\": [],\n                      \"directives\": []\n                    }, {\n                      \"kind\": \"Field\",\n                      \"name\": {\n                        \"kind\": \"Name\",\n                        \"value\": \"ofType\"\n                      },\n                      \"arguments\": [],\n                      \"directives\": [],\n                      \"selectionSet\": {\n                        \"kind\": \"SelectionSet\",\n                        \"selections\": [{\n                          \"kind\": \"Field\",\n                          \"name\": {\n                            \"kind\": \"Name\",\n                            \"value\": \"kind\"\n                          },\n                          \"arguments\": [],\n                          \"directives\": []\n                        }, {\n                          \"kind\": \"Field\",\n                          \"name\": {\n                            \"kind\": \"Name\",\n                            \"value\": \"name\"\n                          },\n                          \"arguments\": [],\n                          \"directives\": []\n                        }, {\n                          \"kind\": \"Field\",\n                          \"name\": {\n                            \"kind\": \"Name\",\n                            \"value\": \"ofType\"\n                          },\n                          \"arguments\": [],\n                          \"directives\": [],\n                          \"selectionSet\": {\n                            \"kind\": \"SelectionSet\",\n                            \"selections\": [{\n                              \"kind\": \"Field\",\n                              \"name\": {\n                                \"kind\": \"Name\",\n                                \"value\": \"kind\"\n                              },\n                              \"arguments\": [],\n                              \"directives\": []\n                            }, {\n                              \"kind\": \"Field\",\n                              \"name\": {\n                                \"kind\": \"Name\",\n                                \"value\": \"name\"\n                              },\n                              \"arguments\": [],\n                              \"directives\": []\n                            }]\n                          }\n                        }]\n                      }\n                    }]\n                  }\n                }]\n              }\n            }]\n          }\n        }]\n      }\n    }],\n    \"loc\": {\n      \"start\": 0,\n      \"end\": 1138,\n      \"source\": {\n        \"body\": \"query introspection_phase_2 {\\n  __schema {\\n    queryType {\\n      name\\n    }\\n    mutationType {\\n      name\\n    }\\n    subscriptionType {\\n      name\\n    }\\n    types {\\n      ...FullType\\n    }\\n    directives {\\n      name\\n      description\\n      args {\\n        ...InputValue\\n      }\\n    }\\n  }\\n}\\n\\nfragment FullType on __Type {\\n  kind\\n  name\\n  description\\n  fields(includeDeprecated: true) {\\n    name\\n    description\\n    args {\\n      ...InputValue\\n    }\\n    type {\\n      ...TypeRef\\n    }\\n    isDeprecated\\n    deprecationReason\\n  }\\n  inputFields {\\n    ...InputValue\\n  }\\n  interfaces {\\n    ...TypeRef\\n  }\\n  enumValues(includeDeprecated: true) {\\n    name\\n    description\\n    isDeprecated\\n    deprecationReason\\n  }\\n  possibleTypes {\\n    ...TypeRef\\n  }\\n}\\n\\nfragment InputValue on __InputValue {\\n  name\\n  description\\n  type {\\n    ...TypeRef\\n  }\\n  defaultValue\\n}\\n\\nfragment TypeRef on __Type {\\n  kind\\n  name\\n  ofType {\\n    kind\\n    name\\n    ofType {\\n      kind\\n      name\\n      ofType {\\n        kind\\n        name\\n        ofType {\\n          kind\\n          name\\n          ofType {\\n            kind\\n            name\\n          }\\n        }\\n      }\\n    }\\n  }\\n}\\n\",\n        \"name\": \"GraphQL request\",\n        \"locationOffset\": {\n          \"line\": 1,\n          \"column\": 1\n        }\n      }\n    }\n  };\n  var operation = phase2.definitions.find(function (t) {\n    return t.kind === \"OperationDefinition\";\n  });\n  var schema = operation.selectionSet.selections.find(function (t) {\n    return t.kind === \"Field\";\n  });\n  var directive = schema.selectionSet.selections.find(function (t) {\n    return t.kind === \"Field\" && t.name.value === \"directives\";\n  });\n  addDirectiveFeatures(directive, features);\n  removeSubscriptionIfNotSupported(schema, features);\n  return phase2;\n}\n\nfunction addDirectiveFeatures(directive, features) {\n  var selections = [];\n  directive.selectionSet.selections.forEach(function (s) {\n    return selections.push(s);\n  });\n\n  if (features.isRepeatable) {\n    selections.push(createFieldNode(\"isRepeatable\"));\n  }\n\n  if (features.locations) {\n    selections.push(createFieldNode(\"locations\"));\n  } else {\n    selections.push(createFieldNode(\"onField\"));\n    selections.push(createFieldNode(\"onFragment\"));\n    selections.push(createFieldNode(\"onOperation\"));\n  }\n\n  directive.selectionSet.selections = selections;\n}\n\nfunction removeSubscriptionIfNotSupported(schema, features) {\n  if (!features.subscription) {\n    var selections = [];\n    schema.selectionSet.selections.forEach(function (s) {\n      if (s.kind === \"Field\" && s.name.value === \"subscriptionType\") {\n        return;\n      }\n\n      selections.push(s);\n    });\n    schema.selectionSet.selections = selections;\n  }\n}\n\nfunction createFieldNode(name) {\n  return {\n    kind: \"Field\",\n    name: {\n      kind: \"Name\",\n      value: name\n    },\n    directives: [],\n    arguments: []\n  };\n}\n\nfunction determineSchemaFeatures(result) {\n  var directive = result.directive;\n  var isRepeatable = !!directive.fields.find(function (t) {\n    return t.name === \"isRepeatable\";\n  });\n  var locations = !!directive.fields.find(function (t) {\n    return t.name === \"locations\";\n  });\n  var schema = result.schema;\n  var subscription = !!schema.fields.find(function (t) {\n    return t.name === \"subscriptionType\";\n  });\n  return {\n    isRepeatable: isRepeatable,\n    locations: locations,\n    subscription: subscription\n  };\n}","import { Message } from \"@bcp/shared/messaging\";\nexport function addHistoryItem(context, documentId, operationFailed, operationType, operationName) {\n  context.sendMessage(new Message({\n    type: \"new-history-item\",\n    payload: {\n      documentId: documentId,\n      operationFailed: operationFailed,\n      operationName: operationName,\n      operationType: operationType\n    }\n  }));\n}","import { Message } from \"@bcp/shared/messaging\";\nexport function appendResultItem(context, documentId, result) {\n  context.sendMessage(new Message({\n    type: \"new-result\",\n    payload: {\n      documentId: documentId,\n      result: result\n    }\n  }));\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { registerServerHandler } from \"./message-handler-registry\";\n// todo: LRU\nvar cache = {};\nexport function registerVariableCacheHandlers() {\n  registerDeleteReceiver();\n  registerSetReceiver();\n}\n\nfunction registerDeleteReceiver() {\n  registerServerHandler(\"variables-cache-delete-item\", function (_ref) {\n    var documentId = _ref.payload.documentId;\n    deleteFromCache(documentId);\n  });\n}\n\nfunction registerSetReceiver() {\n  registerServerHandler(\"variables-cache-set-item\", function (_ref2) {\n    var _ref2$payload = _ref2.payload,\n        documentId = _ref2$payload.documentId,\n        variables = _ref2$payload.variables;\n    set(documentId, variables);\n  });\n}\n\nfunction deleteFromCache(documentId) {\n  cache = _objectSpread(_objectSpread({}, cache), {}, _defineProperty({}, documentId, undefined));\n}\n\nexport function getVariables(documentId) {\n  return cache[documentId];\n}\n\nfunction set(documentId, variables) {\n  cache = _objectSpread(_objectSpread({}, cache), {}, _defineProperty({}, documentId, variables));\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { diff, now } from \"@bcp/shared/utils\";\nimport { Message } from \"@bcp/shared/messaging\";\nimport { logError, logInfo } from \"./console-log-proxy\";\nimport { getDocument } from \"./document-cache\";\nimport { executeOperation } from \"./graphql-client\";\nimport { addHistoryItem } from \"./history-log-proxy\";\nimport { getHeaders } from \"./http-header-cache\";\nimport { appendResultItem } from \"./result-cache-proxy\";\nimport { getVariables } from \"./variable-cache\";\nexport var QueryAndMutationExecutionStrategy = /*#__PURE__*/function () {\n  function QueryAndMutationExecutionStrategy() {\n    _classCallCheck(this, QueryAndMutationExecutionStrategy);\n\n    _defineProperty(this, \"runningOperations\", {});\n  }\n\n  _createClass(QueryAndMutationExecutionStrategy, [{\n    key: \"isExecuting\",\n    value: function isExecuting(context) {\n      return !!this.runningOperations[context.session.documentId];\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(context) {\n      var documentId = context.session.documentId;\n      var operation = this.runningOperations[documentId];\n\n      if (operation) {\n        this.stop(context, documentId);\n        logInfo(context, operation.operationName ? \"Cancelled \".concat(operation.operationType, \" operation \\\"\").concat(operation.operationName, \"\\\".\") : \"Cancelled \".concat(operation.operationType, \" operation.\"));\n      }\n    }\n  }, {\n    key: \"execute\",\n    value: function execute(context, operationType, operationName) {\n      var session = context.session;\n\n      if (!this.runningOperations[session.documentId] && session && session.schemaEndpoint.length > 0) {\n        var _documentId = session.documentId;\n        var headers = getHeaders(_documentId) || {};\n        this.executeCore(context, {\n          documentId: _documentId,\n          httpOptions: {\n            headers: headers,\n            uri: session.schemaEndpoint,\n            useGET: session.httpMethod === \"GET\",\n            credentials: session.credentials\n          },\n          operationName: operationName\n        }, operationType);\n      }\n    }\n  }, {\n    key: \"executeCore\",\n    value: function () {\n      var _executeCore = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(context, options, operationType) {\n        var httpOptions, documentId, operationName, query, start, variables, result, stop, _result$response, parsedBody, error, failed, type, name, message;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                httpOptions = options.httpOptions, documentId = options.documentId, operationName = options.operationName;\n                query = getDocument(documentId);\n\n                if (!query) {\n                  _context.next = 20;\n                  break;\n                }\n\n                start = now();\n                variables = getVariables(documentId) || {};\n                this.runningOperations = _objectSpread(_objectSpread({}, this.runningOperations), {}, _defineProperty({}, documentId, {\n                  operationName: operationName,\n                  operationType: operationType\n                }));\n                context.sendMessage(new Message({\n                  type: \"operation-execution\",\n                  payload: {\n                    documentId: documentId,\n                    isExecuting: true,\n                    isSubscription: false\n                  }\n                }));\n                logInfo(context, operationName ? \"Starting \".concat(operationType, \" operation \\\"\").concat(operationName, \"\\\".\") : \"Starting \".concat(operationType, \" operation.\"), undefined, documentId);\n                _context.next = 10;\n                return executeOperation(httpOptions, {\n                  operationName: operationName,\n                  query: query,\n                  variables: variables\n                });\n\n              case 10:\n                result = _context.sent;\n                stop = now();\n                _result$response = result.response, parsedBody = _result$response.parsedBody, error = _result$response.error;\n                failed = !!error || parsedBody.errors && parsedBody.errors.length > 0 || false;\n                addHistoryItem(context, documentId, failed, operationType, operationName);\n                appendResultItem(context, documentId, {\n                  payload: result,\n                  duration: diff(start, stop),\n                  operationName: operationName,\n                  operationType: operationType,\n                  success: !failed,\n                  timestamp: start\n                });\n                type = operationType === \"query\" ? \"Query\" : \"Mutation\";\n                name = operationName ? \"\\\"\".concat(operationName, \"\\\" \") : \"\";\n                message = \"\".concat(type, \" operation \").concat(name);\n\n                if (failed) {\n                  logError(context, \"\".concat(message, \" failed.\"), error ? error : parsedBody.errors, documentId);\n                } else {\n                  logInfo(context, \"\".concat(message, \" succeeded.\"), undefined, documentId);\n                }\n\n              case 20:\n                this.stop(context, documentId);\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function executeCore(_x, _x2, _x3) {\n        return _executeCore.apply(this, arguments);\n      }\n\n      return executeCore;\n    }()\n  }, {\n    key: \"stop\",\n    value: function stop(context, documentId) {\n      this.runningOperations = _objectSpread(_objectSpread({}, this.runningOperations), {}, _defineProperty({}, documentId, undefined));\n      context.sendMessage(new Message({\n        type: \"operation-execution\",\n        payload: {\n          documentId: documentId,\n          isExecuting: false,\n          isSubscription: false\n        }\n      }));\n    }\n  }]);\n\n  return QueryAndMutationExecutionStrategy;\n}();","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Message } from \"@bcp/shared/messaging\";\nimport { now } from \"@bcp/shared/utils\";\nimport { SubscriptionClient } from \"subscriptions-transport-ws\";\nimport { logError, logInfo } from \"./console-log-proxy\";\nimport { getDocument } from \"./document-cache\";\nimport { addHistoryItem } from \"./history-log-proxy\";\nimport { getHeaders } from \"./http-header-cache\";\nimport { appendResultItem } from \"./result-cache-proxy\";\nimport { getVariables } from \"./variable-cache\";\nexport var SubscriptionExecutionStrategy = /*#__PURE__*/function () {\n  function SubscriptionExecutionStrategy() {\n    _classCallCheck(this, SubscriptionExecutionStrategy);\n\n    _defineProperty(this, \"runningSubscriptions\", {});\n  }\n\n  _createClass(SubscriptionExecutionStrategy, [{\n    key: \"isExecuting\",\n    value: function isExecuting(context) {\n      return !!this.runningSubscriptions[context.session.documentId];\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(context) {\n      var session = context.session;\n\n      if (session) {\n        var subscription = this.runningSubscriptions[session.documentId];\n\n        if (subscription) {\n          var operationName = subscription.operationName,\n              unsubscribe = subscription.unsubscribe;\n          logInfo(context, operationName ? \"Cancelled subscription operation \\\"\".concat(operationName, \"\\\".\") : \"Cancelled subscription operation.\", undefined, session.documentId);\n          unsubscribe();\n          this.runningSubscriptions = _objectSpread(_objectSpread({}, this.runningSubscriptions), {}, _defineProperty({}, session.documentId, undefined));\n          context.sendMessage(new Message({\n            type: \"operation-execution\",\n            payload: {\n              documentId: session.documentId,\n              isExecuting: false,\n              isSubscription: true\n            }\n          }));\n        }\n      }\n    }\n  }, {\n    key: \"execute\",\n    value: function execute(context, operationType, operationName) {\n      var session = context.session;\n\n      if (session && !this.runningSubscriptions[session.documentId]) {\n        var headers = getHeaders(session.documentId) || {};\n        var endpoint = SubscriptionExecutionStrategy.getSchemaEndpoint(session);\n\n        if (!!endpoint.length) {\n          this.executeCore(context, {\n            documentId: session.documentId,\n            httpOptions: {\n              headers: headers,\n              uri: endpoint,\n              useGET: session.httpMethod === \"GET\",\n              credentials: session.credentials\n            },\n            operationName: operationName\n          }, operationType);\n        }\n      }\n    }\n  }, {\n    key: \"executeCore\",\n    value: function executeCore(context, options, operationType) {\n      var _this = this;\n\n      var documentId = options.documentId,\n          httpOptions = options.httpOptions,\n          operationName = options.operationName;\n      var query = getDocument(documentId);\n\n      if (query) {\n        logInfo(context, operationName ? \"Subscribing to subscription \\\"\".concat(operationName, \"\\\".\") : \"Subscribing to subscription.\", undefined, documentId);\n        var variables = getVariables(documentId) || {};\n        var client = new SubscriptionClient(httpOptions.uri, {\n          lazy: true\n        });\n        client.onConnected(function () {\n          _this.runningSubscriptions = _objectSpread(_objectSpread({}, _this.runningSubscriptions), {}, _defineProperty({}, documentId, subscription));\n          context.sendMessage(new Message({\n            type: \"operation-execution\",\n            payload: {\n              documentId: documentId,\n              isExecuting: true,\n              isSubscription: true\n            }\n          }));\n          addHistoryItem(context, documentId, false, operationType, operationName);\n        });\n        client.onError(function (error) {\n          logError(context, operationName ? \"Subscribing to subscription \\\"\".concat(operationName, \"\\\" failed.\") : \"Subscribing to subscription failed.\", error, documentId);\n          addHistoryItem(context, documentId, true, operationType, operationName);\n        });\n        var observable = client.request({\n          operationName: operationName,\n          query: query,\n          variables: variables\n        });\n        var subscription = observable.subscribe({\n          next: function next(result) {\n            var failed = result && result.errors && result.errors.length > 0 || false;\n\n            if (failed) {\n              logError(context, \"New subscription result arrived.\", result.errors, documentId);\n            } else {\n              logInfo(context, \"New subscription result arrived.\", undefined, documentId);\n            }\n\n            appendResultItem(context, documentId, {\n              payload: {\n                raw: result\n              },\n              duration: 0,\n              operationName: operationName,\n              operationType: operationType,\n              success: !failed,\n              timestamp: now()\n            });\n          },\n          error: function error(_error) {\n            logError(context, \"A subscription result ended up in an error.\", _error, documentId);\n            appendResultItem(context, documentId, {\n              payload: {\n                error: _error\n              },\n              duration: 0,\n              operationName: operationName,\n              operationType: operationType,\n              success: false,\n              timestamp: now()\n            });\n          },\n          complete: function complete() {\n            logInfo(context, operationName ? \"Unsubscribing from subscription \\\"\".concat(operationName, \"\\\".\") : \"Unsubscribing from subscription.\", undefined, documentId);\n          }\n        });\n      }\n    }\n  }], [{\n    key: \"getSchemaEndpoint\",\n    value: function getSchemaEndpoint(session) {\n      return !session.subscriptionEndpoint && session.schemaEndpoint ? session.schemaEndpoint.replace(/^http/i, \"ws\") : session.subscriptionEndpoint || \"\";\n    }\n  }]);\n\n  return SubscriptionExecutionStrategy;\n}();","import { getDocument } from \"./document-cache\";\nimport { registerServerHandler } from \"./message-handler-registry\";\nimport { QueryAndMutationExecutionStrategy } from \"./query-and-mutation-execution-strategy\";\nimport { SubscriptionExecutionStrategy } from \"./subscription-execution-strategy\";\nimport { getOperationType } from \"./utils\";\nvar queryAndMutationStrategy = new QueryAndMutationExecutionStrategy();\nvar subscriptionStrategy = new SubscriptionExecutionStrategy();\nvar strategies = new Map([[\"query\", queryAndMutationStrategy], [\"mutation\", queryAndMutationStrategy], [\"subscription\", subscriptionStrategy]]);\nexport function registerOperationExecuterHandlers() {\n  registerCancelReceiver();\n  registerExecutionReceiver();\n}\n\nfunction registerCancelReceiver() {\n  registerServerHandler(\"cancel-operation-execution\", function (_message, context) {\n    cancel(context);\n  });\n}\n\nfunction registerExecutionReceiver() {\n  registerServerHandler(\"begin-operation-execution\", function (_ref, context) {\n    var payload = _ref.payload;\n    execute(context, payload.operationName);\n  });\n}\n\nfunction cancel(context) {\n  if (queryAndMutationStrategy.isExecuting(context)) {\n    queryAndMutationStrategy.cancel(context);\n  }\n\n  if (subscriptionStrategy.isExecuting(context)) {\n    subscriptionStrategy.cancel(context);\n  }\n}\n\nfunction execute(context, operationName) {\n  if (!queryAndMutationStrategy.isExecuting(context) && !subscriptionStrategy.isExecuting(context)) {\n    var query = getDocument(context.session.documentId);\n\n    if (query) {\n      var operationType = getOperationType(query, operationName);\n      var strategy = strategies.get(operationType);\n\n      if (strategy) {\n        strategy.execute(context, operationType, operationName);\n      }\n    }\n  }\n}","export function getOperationType(document, operationName) {\n  var operationNodes = document.definitions.map(function (d) {\n    return d;\n  }).filter(function (o) {\n    return !!o;\n  });\n  var operationNode = operationNodes.length === 1 ? operationNodes[0] : operationNodes.find(function (o) {\n    return o.name && o.name.value === operationName || false;\n  });\n  return operationNode ? operationNode.operation : \"query\";\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { Message } from \"@bcp/shared/messaging\";\nimport { GraphQLEnumType, GraphQLInputObjectType, GraphQLInterfaceType, GraphQLList, GraphQLNonNull, GraphQLObjectType, GraphQLScalarType, GraphQLUnionType } from \"graphql\";\nimport { registerServerHandler } from \"./message-handler-registry\";\nimport { getSchema } from \"./schema-cache\";\nexport function registerSchemaBrowserHandlers() {\n  registerFetchSchemaFieldTypeReceiver();\n  registerFetchSchemaFieldTypesReceiver();\n  registerFetchSchemaTypeReceiver();\n  registerFetchSchemaRootTypesReceiver();\n}\n\nfunction registerFetchSchemaFieldTypeReceiver() {\n  registerServerHandler(\"fetch-schema-field-type\", /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(_ref, context) {\n      var id, request, type, record, payload;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              id = _ref.id, request = _ref.payload, type = _ref.type;\n              _context.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context.sent;\n              payload = undefined;\n\n              if (record) {\n                payload = fetchFieldType(record.schema, request.typeName, request.fieldName);\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n}\n\nfunction registerFetchSchemaFieldTypesReceiver() {\n  registerServerHandler(\"fetch-schema-field-types\", /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(_ref3, context) {\n      var id, typeName, type, record, payload;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              id = _ref3.id, typeName = _ref3.payload, type = _ref3.type;\n              _context2.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context2.sent;\n              payload = undefined;\n\n              if (record) {\n                payload = fetchFieldTypes(record.schema, typeName);\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x3, _x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n}\n\nfunction registerFetchSchemaRootTypesReceiver() {\n  registerServerHandler(\"fetch-schema-types\", /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(_ref5, context) {\n      var id, type, record, payload;\n      return regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              id = _ref5.id, type = _ref5.type;\n              _context3.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context3.sent;\n              payload = undefined;\n\n              if (record) {\n                payload = fetchRootTypes(record.schema);\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x5, _x6) {\n      return _ref6.apply(this, arguments);\n    };\n  }());\n}\n\nfunction registerFetchSchemaTypeReceiver() {\n  registerServerHandler(\"fetch-schema-type\", /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(_ref7, context) {\n      var id, typeName, type, record, payload;\n      return regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              id = _ref7.id, typeName = _ref7.payload, type = _ref7.type;\n              _context4.next = 3;\n              return getSchema(context);\n\n            case 3:\n              record = _context4.sent;\n              payload = undefined;\n\n              if (record) {\n                payload = fetchType(record.schema, typeName);\n              }\n\n              context.sendMessage(new Message({\n                id: id,\n                type: type,\n                payload: payload\n              }));\n\n            case 7:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function (_x7, _x8) {\n      return _ref8.apply(this, arguments);\n    };\n  }());\n}\n\nfunction fetchFieldType(schema, typeName, fieldName) {\n  var type = schema.getType(typeName);\n\n  if (type) {\n    return getSchemaFieldType(schema, type, fieldName);\n  }\n\n  return undefined;\n}\n\nfunction fetchFieldTypes(schema, typeName) {\n  var type = schema.getType(typeName);\n\n  if (type) {\n    return getSchemaFieldTypes(schema, type);\n  }\n\n  return undefined;\n}\n\nfunction fetchRootTypes(schema) {\n  var rootTypes = [];\n  var queryType = schema.getQueryType();\n  var mutationType = schema.getMutationType();\n  var subscriptionType = schema.getSubscriptionType();\n\n  if (queryType) {\n    rootTypes.push(getSchemaType(schema, queryType));\n  }\n\n  if (mutationType) {\n    rootTypes.push(getSchemaType(schema, mutationType));\n  }\n\n  if (subscriptionType) {\n    rootTypes.push(getSchemaType(schema, subscriptionType));\n  }\n\n  return rootTypes.length === 0 ? undefined : rootTypes;\n}\n\nfunction fetchType(schema, name) {\n  var type = schema.getType(name);\n\n  if (type) {\n    return getSchemaType(schema, type);\n  }\n\n  return undefined;\n}\n\nfunction getKind(type) {\n  if (type instanceof GraphQLEnumType) {\n    return \"enum\";\n  }\n\n  if (type instanceof GraphQLInputObjectType) {\n    return \"input-object\";\n  }\n\n  if (type instanceof GraphQLInterfaceType) {\n    return \"interface\";\n  }\n\n  if (type instanceof GraphQLScalarType) {\n    return \"scalar\";\n  }\n\n  if (type instanceof GraphQLUnionType) {\n    return \"union\";\n  }\n\n  if (type instanceof GraphQLList || type instanceof GraphQLNonNull) {\n    return getKind(type.ofType);\n  }\n\n  return \"object\";\n}\n\nfunction getSchemaFieldType(schema, type, fieldName) {\n  if (type instanceof GraphQLInputObjectType) {\n    var field = type.getFields()[fieldName];\n\n    if (field) {\n      return {\n        id: \"\".concat(type.name, \"-\").concat(field.name),\n        name: field.name,\n        kind: \"field\",\n        description: field.description || undefined,\n        valueType: getSchemaValueType(schema, field.type),\n        defaultValue: field.defaultValue\n      };\n    }\n  } else if (type instanceof GraphQLInterfaceType || type instanceof GraphQLObjectType) {\n    var _field = type.getFields()[fieldName];\n\n    if (_field) {\n      var args = _field.args.length === 0 ? undefined : _field.args.map(function (a) {\n        var valueType = getSchemaValueType(schema, a.type);\n        return {\n          id: \"\".concat(type.name, \"-\").concat(_field.name, \"-\").concat(a.name),\n          name: a.name,\n          kind: \"argument\",\n          description: a.description || undefined,\n          defaultValue: a.defaultValue || undefined,\n          type: valueType\n        };\n      });\n      return {\n        id: \"\".concat(type.name, \"-\").concat(_field.name),\n        name: _field.name,\n        kind: \"field\",\n        description: _field.description || undefined,\n        arguments: args,\n        valueType: getSchemaValueType(schema, _field.type),\n        isDeprecated: _field.isDeprecated,\n        deprecationReason: _field.deprecationReason || undefined\n      };\n    }\n  }\n\n  return undefined;\n}\n\nfunction getSchemaFieldTypes(schema, type) {\n  var result = [];\n\n  if (type instanceof GraphQLInputObjectType) {\n    var fields = type.getFields();\n\n    for (var fieldName in fields) {\n      var field = fields[fieldName];\n      result.push({\n        id: \"\".concat(type.name, \"-\").concat(field.name),\n        name: field.name,\n        kind: \"field\",\n        description: field.description || undefined,\n        valueType: getSchemaValueType(schema, field.type),\n        defaultValue: field.defaultValue\n      });\n    }\n  } else if (type instanceof GraphQLInterfaceType || type instanceof GraphQLObjectType) {\n    var _fields = type.getFields();\n\n    var _loop = function _loop(_fieldName) {\n      var field = _fields[_fieldName];\n      var args = field.args.length === 0 ? undefined : field.args.map(function (a) {\n        var valueType = getSchemaValueType(schema, a.type);\n        return {\n          id: \"\".concat(type.name, \"-\").concat(field.name, \"-\").concat(a.name),\n          name: a.name,\n          kind: \"argument\",\n          description: a.description || undefined,\n          defaultValue: a.defaultValue || undefined,\n          type: valueType\n        };\n      });\n      result.push({\n        id: \"\".concat(type.name, \"-\").concat(field.name),\n        name: field.name,\n        kind: \"field\",\n        description: field.description || undefined,\n        arguments: args,\n        valueType: getSchemaValueType(schema, field.type),\n        isDeprecated: field.isDeprecated,\n        deprecationReason: field.deprecationReason || undefined\n      });\n    };\n\n    for (var _fieldName in _fields) {\n      _loop(_fieldName);\n    }\n  }\n\n  return result;\n}\n\nfunction getSchemaType(schema, type) {\n  var enumValues;\n  var interfaces;\n  var types;\n\n  if (type instanceof GraphQLEnumType) {\n    enumValues = type.getValues().map(function (v) {\n      return {\n        id: \"\".concat(type.name, \"-\").concat(v.name),\n        name: v.name,\n        kind: \"enum-value\",\n        description: v.description || undefined,\n        value: v.value,\n        isDeprecated: v.isDeprecated,\n        deprecationReason: v.deprecationReason || undefined\n      };\n    });\n  }\n\n  if (type instanceof GraphQLInterfaceType) {\n    types = schema.getPossibleTypes(type).map(function (type) {\n      return getSchemaValueType(schema, type);\n    });\n  }\n\n  if (type instanceof GraphQLObjectType) {\n    interfaces = type.getInterfaces().map(function (i) {\n      return {\n        id: i.name,\n        name: i.name,\n        kind: \"type\",\n        description: i.description || undefined,\n        typeKind: \"interface\"\n      };\n    });\n  }\n\n  if (type instanceof GraphQLUnionType) {\n    types = type.getTypes().map(function (type) {\n      return getSchemaValueType(schema, type);\n    });\n  }\n\n  return {\n    id: type.name,\n    name: type.name,\n    kind: \"type\",\n    description: type.description || undefined,\n    typeKind: getKind(type),\n    enumValues: enumValues,\n    interfaces: interfaces,\n    types: types\n  };\n}\n\nfunction getSchemaValueType(schema, type) {\n  var innerType;\n  var isList = false;\n  var isOptional = true;\n  var resultType;\n\n  if (type instanceof GraphQLNonNull) {\n    isOptional = false;\n\n    if (type.ofType instanceof GraphQLList) {\n      innerType = type.ofType.ofType;\n      isList = true;\n    } else {\n      innerType = type.ofType;\n    }\n  } else if (type instanceof GraphQLList) {\n    innerType = type.ofType;\n    isList = true;\n  } else {\n    innerType = type;\n  }\n\n  if (innerType instanceof GraphQLList || innerType instanceof GraphQLNonNull) {\n    resultType = getSchemaValueType(schema, innerType);\n  } else {\n    resultType = getSchemaType(schema, innerType);\n  }\n\n  return {\n    kind: \"value-type\",\n    isList: isList,\n    isOptional: isOptional,\n    type: resultType\n  };\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { Message } from \"@bcp/shared/messaging\";\nimport { createId } from \"@bcp/shared/utils\";\nimport { Backoff } from \"./utils\";\nimport { logError, logInfo } from \"./console-log-proxy\";\nimport { fetchSchema } from \"./graphql-client\";\nimport { getHeaders } from \"./http-header-cache\";\nimport { updateSchema } from \"./language-service\";\nimport { registerServerHandler } from \"./message-handler-registry\";\nimport { getSchema, setSchema } from \"./schema-cache\";\nvar stateMap = new Map();\nexport function registerSchemaFetcherHandlers() {\n  registerCancelFetchingReceiver();\n  registerFetchingReceiver();\n  registerRefetchingReceiver();\n}\n\nfunction registerCancelFetchingReceiver() {\n  registerServerHandler(\"cancel-schema-fetching\", function (_message, context) {\n    cancel(context);\n  });\n}\n\nfunction registerFetchingReceiver() {\n  registerServerHandler(\"fetch-schema\", function (_message, context) {\n    fetch(context);\n  });\n}\n\nfunction registerRefetchingReceiver() {\n  registerServerHandler(\"refetch-schema\", function (_message, context) {\n    refetch(context);\n  });\n}\n\nfunction cancel(context) {\n  var state = stateMap.get(context.id);\n\n  if (!!(state === null || state === void 0 ? void 0 : state.running)) {\n    if (state.backoff) {\n      logInfo(context, \"Cancelled schema fetching.\", undefined, state.currentId);\n    }\n\n    if (state.timeout) {\n      logInfo(context, \"Cancelled schema polling.\", undefined, state.currentId);\n    }\n\n    stop(context);\n  }\n}\n\nfunction fetch(_x) {\n  return _fetch.apply(this, arguments);\n}\n\nfunction _fetch() {\n  _fetch = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(context) {\n    var state, session, headers, httpOptions, cachedSchema;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            state = getStateOrDefault(context.id);\n\n            if (state.running) {\n              _context.next = 14;\n              break;\n            }\n\n            session = context.session;\n\n            if (!(session.schemaEndpoint.length > 0)) {\n              _context.next = 13;\n              break;\n            }\n\n            headers = getHeaders(session.documentId) || {};\n            httpOptions = {\n              headers: headers,\n              uri: session.schemaEndpoint,\n              useGETForQueries: session.httpMethod === \"GET\",\n              credentials: session.credentials\n            };\n            _context.next = 8;\n            return getSchema(context);\n\n          case 8:\n            cachedSchema = _context.sent;\n\n            if (cachedSchema) {\n              updateSchema(context, {\n                endpoint: session.schemaEndpoint,\n                exists: true,\n                hash: cachedSchema.hash,\n                hasMutationType: !!cachedSchema.schema.getMutationType(),\n                hasSubscriptionType: !!cachedSchema.schema.getSubscriptionType()\n              });\n              logInfo(context, \"Fetched schema from cache.\");\n            }\n\n            if (session.enableSchemaPolling) {\n              state = setState(context.id, {\n                running: true\n              });\n              logInfo(context, \"Started schema polling.\");\n              startPolling(context, httpOptions, session.schemaPollingInterval || 20000);\n            } else if (!cachedSchema) {\n              state = setState(context.id, {\n                running: true\n              });\n              logInfo(context, \"Started schema fetching.\");\n              startFetching(context, httpOptions);\n            }\n\n            _context.next = 14;\n            break;\n\n          case 13:\n            updateSchema(context, {\n              endpoint: session.schemaEndpoint,\n              exists: false,\n              hasMutationType: false,\n              hasSubscriptionType: false\n            });\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _fetch.apply(this, arguments);\n}\n\nfunction fetchCore(_x2, _x3, _x4, _x5) {\n  return _fetchCore.apply(this, arguments);\n}\n\nfunction _fetchCore() {\n  _fetchCore = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(context, _ref, requestId, options) {\n    var currentRequestId, schemaOrError;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            currentRequestId = _ref.currentRequestId;\n            _context2.next = 3;\n            return fetchSchema(options);\n\n          case 3:\n            schemaOrError = _context2.sent;\n\n            if (!(requestId === currentRequestId)) {\n              _context2.next = 14;\n              break;\n            }\n\n            if (!isIntrospectionQuery(schemaOrError)) {\n              _context2.next = 11;\n              break;\n            }\n\n            _context2.next = 8;\n            return setSchema(context, schemaOrError);\n\n          case 8:\n            logInfo(context, \"Fetched schema successfully.\");\n            _context2.next = 14;\n            break;\n\n          case 11:\n            updateSchema(context, {\n              endpoint: options.uri,\n              exists: false,\n              hasMutationType: false,\n              hasSubscriptionType: false\n            });\n            logError(context, \"Fetching schema failed.\", schemaOrError);\n            return _context2.abrupt(\"return\", false);\n\n          case 14:\n            return _context2.abrupt(\"return\", true);\n\n          case 15:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _fetchCore.apply(this, arguments);\n}\n\nfunction getStateOrDefault(contextId) {\n  return stateMap.get(contextId) || {\n    fetching: false,\n    running: false\n  };\n}\n\nfunction isIntrospectionQuery(input) {\n  return \"__schema\" in input;\n}\n\nfunction refetch(context) {\n  var _getStateOrDefault = getStateOrDefault(context.id),\n      running = _getStateOrDefault.running;\n\n  if (!running) {\n    var session = context.session;\n\n    if (session.schemaEndpoint.length > 0 && !session.enableSchemaPolling) {\n      var headers = getHeaders(session.documentId) || {};\n      var httpOptions = {\n        headers: headers,\n        uri: session.schemaEndpoint,\n        useGETForQueries: session.httpMethod === \"GET\",\n        credentials: session.credentials\n      };\n      setState(context.id, {\n        running: true\n      });\n      logInfo(context, \"Reload schema.\");\n      startFetching(context, httpOptions);\n    }\n  }\n}\n\nfunction sendMessage(context, fetching) {\n  context.sendMessage(new Message({\n    type: \"is-schema-fetching\",\n    payload: fetching\n  }));\n}\n\nfunction setState(contextId, changes) {\n  var state = getStateOrDefault(contextId);\n\n  var newState = _objectSpread(_objectSpread({}, state), changes);\n\n  stateMap.set(contextId, newState);\n  return newState;\n}\n\nfunction startFetching(context, options) {\n  var contextId = context.id;\n  var documentId = context.session.documentId;\n  var requestId = createId();\n  var backoff = new Backoff(function (count) {\n    var state = getStateOrDefault(contextId);\n\n    if (count > 0) {\n      logInfo(context, \"Retry schema fetching.\");\n    } else {\n      state = setState(contextId, {\n        fetching: true\n      });\n      sendMessage(context, state.fetching);\n    }\n\n    return fetchCore(context, state, requestId, options);\n  });\n  setState(contextId, {\n    backoff: backoff,\n    currentId: documentId,\n    currentRequestId: requestId\n  });\n  backoff.start(function () {\n    var state = getStateOrDefault(contextId);\n\n    if (requestId === state.currentRequestId) {\n      stop(context);\n    }\n  });\n}\n\nfunction startPolling(context, options, pollingInterval) {\n  var requestId = createId();\n  var state = setState(context.id, {\n    currentId: context.session.documentId,\n    currentRequestId: requestId,\n    timeout: window.setTimeout(function () {\n      startPolling(context, options, pollingInterval);\n    }, pollingInterval)\n  });\n  fetchCore(context, state, requestId, options);\n}\n\nfunction stop(context) {\n  var state = getStateOrDefault(context.id);\n\n  if (state.backoff) {\n    state.backoff.stop();\n  }\n\n  if (state.timeout) {\n    window.clearTimeout(state.timeout);\n  }\n\n  state = setState(context.id, {\n    backoff: undefined,\n    currentId: undefined,\n    currentRequestId: undefined,\n    fetching: false,\n    running: false,\n    timeout: undefined\n  });\n  sendMessage(context, state.fetching);\n}","import { WorkerContext } from \"./worker-context\";\nimport { registerDocumentCacheHandlers } from \"./document-cache\";\nimport { registerHeaderCacheHandlers } from \"./http-header-cache\";\nimport { registerLanguageServiceHandlers } from \"./language-service\";\nimport { registerOperationExecuterHandlers } from \"./operation-executer\";\nimport { registerSchemaBrowserHandlers } from \"./schema-browser\";\nimport { registerSchemaFetcherHandlers } from \"./schema-fetcher\";\nimport { registerVariableCacheHandlers } from \"./variable-cache\";\nvar contexts = [];\nvar serverHandlers = [];\n\nfunction handleServerMessage(context, message) {\n  serverHandlers.filter(function (handler) {\n    return handler.type === message.type;\n  }).forEach(function (_ref) {\n    var handle = _ref.handle;\n    return handle(message, context);\n  });\n}\n\nexport function initializeSchemaWorker(port) {\n  var context = new WorkerContext(port);\n  contexts.push(context);\n  registerDocumentCacheHandlers();\n  registerHeaderCacheHandlers();\n  registerVariableCacheHandlers();\n  registerLanguageServiceHandlers();\n  registerSchemaBrowserHandlers();\n  registerOperationExecuterHandlers();\n  registerSchemaFetcherHandlers();\n\n  port.onmessage = function (_ref2) {\n    var data = _ref2.data;\n    handleServerMessage(context, data);\n  };\n\n  port.start();\n}\nexport function registerServerHandler(type, handle) {\n  serverHandlers.push({\n    type: type,\n    handle: handle\n  });\n}","import { initializeSchemaWorker } from \"./message-handler-registry\";\nvar _self = self;\n\n_self.onconnect = function (e) {\n  return initializeSchemaWorker(e.ports[0]);\n};"],"sourceRoot":""}