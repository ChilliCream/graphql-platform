{"componentChunkName":"component---src-templates-blog-article-template-tsx","path":"/blog/2019/11/25/strawberry-shake_2","result":{"data":{"markdownRemark":{"frontmatter":{"featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACBklEQVQoz22QS2/TUBBG/WP5BV2yogvEDrFCQgLEhgVij1ABIRVoEzVtSNO0cfPyI3b9ShO/4zjOYZymQqBe6dy59sz3zdyrIGuz2+q42X7UcXd4YD2U2+z+K/X2L38FURThed6WwPNxHYc0Tbe5SmruWVd3lNXOsPbfVBvuz/crSRKCIGARR8zThHkYkWY5leRqcbGuKMqK5aoiL+9Q/r9C3XFVrqWw3AqHI5XBQQPtyxG384CynjxbEucFmRgkYhzLEFGxZrEsUepRa6F9HRDOsu181o3LRDcJVwXe7yFnr97zdf8Z7Y+f8JdLricGveEEL8mZ6fIspy5eXOAmBUohE4Xhku9vT7k6MrACH812GJsWfcsi6Tm8fv6YNy+fMDxo0dE0hpZHf3pDt69hHxhMP2uYFz5GJoaJvIPrxvSaJoOug2pMuRzr9EY6WrBgpNkcPtqjtbfPUbNFSx3T6Krb2Hdu0dpym2+GNIkYzDMUP13hZUK+wpWzHS05H5u0BxqqCHQ/ovviA+dP39HoXDKJV5wMTBqqRj9IuRKT3izlIkg4l8GUqRiYYY6+yNGEiRToUcEkLBjNc1Q/5kTExxcDOtaMnl+LU7p+RtuJOLNDWsKJFdIUlNFtxkA6XAtq3dFP6HkxXelWd+zUMcjoCKeOmNu1cEFjuuBY+GXO+Sn8MOYcCn8ASYzqtbYbvi4AAAAASUVORK5CYII=","aspectRatio":2,"src":"/static/c59e0fc03a4c1ca4d193f15390c1bdda/ee604/strawberry-shake-banner.png","srcSet":"/static/c59e0fc03a4c1ca4d193f15390c1bdda/69585/strawberry-shake-banner.png 200w,\n/static/c59e0fc03a4c1ca4d193f15390c1bdda/497c6/strawberry-shake-banner.png 400w,\n/static/c59e0fc03a4c1ca4d193f15390c1bdda/ee604/strawberry-shake-banner.png 800w,\n/static/c59e0fc03a4c1ca4d193f15390c1bdda/f3583/strawberry-shake-banner.png 1200w","sizes":"(max-width: 800px) 100vw, 800px"}}},"path":"/blog/2019/11/25/strawberry-shake_2","title":"Building a real-time .NET GraphQL Client API","tags":["strawberry-shake","graphql","dotnet","aspnetcore"],"author":"Michael Staib","authorImageUrl":"https://avatars1.githubusercontent.com/u/9714350?s=100&v=4","authorUrl":"https://github.com/michaelstaib","date":"November 25, 2019"},"html":"<p>We are busy, busy, busy working on version 11 of <em>Hot Chocolate</em> and <em>Strawberry Shake</em>.</p>\n<p>In this post I want to explore the client side of GraphQL on .NET more with a special emphasis on subscriptions.</p>\n<p>Since, with the new version of <em>Strawberry Shake</em> our initial blog has become kind of invalid I also will walk you trough the basics again before heading into subscriptions and what lies beyond.</p>\n<h2 id=\"getting-started\" style=\"position:relative;\"><a href=\"#getting-started\" aria-label=\"getting started permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Getting Started</h2>\n<p>Let us have a look at how we want to tackle things with <em>Strawberry Shake</em>. For this little walk-through I will use our <a href=\"https://github.com/ChilliCream/hotchocolate/tree/master/examples/AspNetCore.StarWars\"><em>Star Wars</em> server example</a>.</p>\n<p>If you want to follow along then install the <a href=\"https://dotnet.microsoft.com/download/dotnet-core/3.0\">.NET Core 3 SDK</a> . We are also supporting other .NET variants but for this example you will need the .NET Core 3 SDK.</p>\n<p>Before we can start let us clone the <em>Hot Chocolate</em> repository and start our <em>Star Wars</em> server.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"23788847740665190000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`git clone https://github.com/ChilliCream/hotchocolate.git\ncd hotchocolate\ndotnet run --project examples/AspNetCore.StarWars/`, `23788847740665190000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/ChilliCream/hotchocolate.git\n<span class=\"token builtin class-name\">cd</span> hotchocolate\ndotnet run --project examples/AspNetCore.StarWars/</code></pre></div>\n<p>Now that we have our <em>Star Wars</em> server running, lets create a folder for our client and install the <em>Strawberry Shake</em> CLI tools.\nThe <em>Strawberry Shake</em> CLI tools are optional but make initializing the client project much easier.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"45409986837819580000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`mkdir berry\ndotnet new tool-manifest\ndotnet tool install StrawberryShake.Tools --version 11.0.0-preview.58 --local`, `45409986837819580000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> berry\ndotnet new tool-manifest\ndotnet tool <span class=\"token function\">install</span> StrawberryShake.Tools --version <span class=\"token number\">11.0</span>.0-preview.58 --local</code></pre></div>\n<p>In our example we are using the new .NET CLI local tools. <code class=\"language-text\">dotnet new tool-manifest</code> creates the tools manifest which basically is like a packages.config and holds the information of which tools in which version we are using in our directory.</p>\n<p>This is the great thing about local tools if you think about it, you can install tools to your repository and have always the right set of tools available to you in the moment you clone that repository.</p>\n<p>The next command <code class=\"language-text\">dotnet tool install StrawberryShake.Tools --version 11.0.0-preview.58 --local</code> installs our <em>Strawberry Shake</em> tools. Once we have a final release of <em>Strawberry Shake</em> you do not need to speciefy the version anymore.</p>\n<p>Next we need a little project. Let’s create a new console application so that we can easily run and debug what we are doing.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"64524292106061680000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`dotnet new console -n BerryClient\ncd BerryClient\ndotnet add package StrawberryShake --version 11.0.0-preview.58\ndotnet add package Microsoft.Extensions.Http --version 3.0.0\ndotnet add package Microsoft.Extensions.DependencyInjection --version 3.0.0`, `64524292106061680000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet new console -n BerryClient\n<span class=\"token builtin class-name\">cd</span> BerryClient\ndotnet <span class=\"token function\">add</span> package StrawberryShake --version <span class=\"token number\">11.0</span>.0-preview.58\ndotnet <span class=\"token function\">add</span> package Microsoft.Extensions.Http --version <span class=\"token number\">3.0</span>.0\ndotnet <span class=\"token function\">add</span> package Microsoft.Extensions.DependencyInjection --version <span class=\"token number\">3.0</span>.0</code></pre></div>\n<p>OK, now that we have a project setup lets initialize the project by creating a local schema. Like with <em>Relay</em> we are holding a local schema file that can be extended with local types and fields. Our <em>GraphQL</em> compiler will use this schema information to validate the queries we write. This makes <em>GraphQL</em> query documents a part of the compilation process and with that a first-class citizen of our C# library.</p>\n<blockquote>\n<p>For the next step ensure that the <em>Star Wars</em> <em>GraphQL</em> server is running since we will fetch the schema from the server.</p>\n</blockquote>\n<blockquote>\n<p>If you want to check out what commands are available with the tools just run <code class=\"language-text\">dotnet graphql</code> and the CLI tools will output the available commands.</p>\n</blockquote>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"73886971744599490000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`dotnet graphql init http://localhost:5000/graphql -n StarWars -p ./StarWars`, `73886971744599490000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet graphql init http://localhost:5000/graphql -n StarWars -p ./StarWars</code></pre></div>\n<p>The init command will download the schema as GraphQL SDL and create a config to re-fetch the schema. Also, the config contains the client name. The client name defines how the client class and interface shall be named.</p>\n<blockquote>\n<p>Note: You can pass in the token and scheme if your endpoint is authenticated. There is also an update command to update the local schema.</p>\n</blockquote>\n<p>The configuration will look like the following:</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"68941457963460430000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`{\n  &quot;Schemas&quot;: [\n    {\n      &quot;Name&quot;: &quot;StarWars&quot;,\n      &quot;Type&quot;: &quot;http&quot;,\n      &quot;File&quot;: &quot;StarWars.graphql&quot;,\n      &quot;Url&quot;: &quot;http://localhost:5000/graphql&quot;\n    }\n  ],\n  &quot;ClientName&quot;: &quot;StarWarsClient&quot;\n}`, `68941457963460430000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Schemas\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"StarWars\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"File\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"StarWars.graphql\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:5000/graphql\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"ClientName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"StarWarsClient\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>OK, now let’s get started by creating our first client API. For this open your editor of choice. I can recommend using <em>VSCode</em> for this at the moment since you will get GraphQL highlighting. As we move forward, we will refine the tooling and provide proper IntelliSense.</p>\n<p>Now let us create a new file in our <code class=\"language-text\">StarWars</code> folder called <code class=\"language-text\">Queries.graphql</code> and add the following query:</p>\n<blockquote>\n<p>The file does not necessarily have to be called queries. You can call it however you want. The GraphQL compiler will figure out what files contain queries and what files contain schema definitions.</p>\n</blockquote>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"8423210345031306000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query getFoo {\n  foo\n}`, `8423210345031306000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getFoo <span class=\"token punctuation\">{</span>\n  foo\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now build your project.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"36528217440029475000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`dotnet build`, `36528217440029475000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet build</code></pre></div>\n<p>When we now compile, we get an <em>MSBuild</em> error on which we can click in <em>VSCode</em> and we are pointed to the place in our query file from which the error stems from. The error tells us that there is no field <code class=\"language-text\">foo</code> on the <code class=\"language-text\">Query</code> type.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"88822265502260600000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`/Users/michael/Local/play/berry/BerryClient/StarWars/Queries.graphql(2,3): error GQL: The field \\`foo\\` does not exist on the type \\`Query\\`. [/Users/michael/Local/play/berry/BerryClient/BerryClient.csproj]`, `88822265502260600000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/Users/michael/Local/play/berry/BerryClient/StarWars/Queries.graphql<span class=\"token punctuation\">(</span><span class=\"token number\">2,3</span><span class=\"token punctuation\">)</span>: error GQL: The field <span class=\"token variable\"><span class=\"token variable\">`</span>foo<span class=\"token variable\">`</span></span> does not exist on the <span class=\"token builtin class-name\">type</span> <span class=\"token variable\"><span class=\"token variable\">`</span>Query<span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span> <span class=\"token punctuation\">[</span>/Users/michael/Local/play/berry/BerryClient/BerryClient.csproj<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Your GraphQL query document is not just a string, it properly compiles and is fully typed. Let's change our query and compile again:</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"4260035791624617000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query getFoo {\n  hero {\n    name\n  }\n}`, `4260035791624617000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getFoo <span class=\"token punctuation\">{</span>\n  hero <span class=\"token punctuation\">{</span>\n    name\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"99639083006758830000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`dotnet build`, `99639083006758830000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet build</code></pre></div>\n<p>Now our project changes and we get a new <code class=\"language-text\">Generated</code> folder that has all the types that we need to communicate with our backend.</p>\n<p>Let us have a closer look at our client interface for a minute.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"54885321550953450000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface IStarWarsClient\n{\n    Task<IOperationResult<IGetFoo>> GetFooAsync(\n        CancellationToken cancellationToken = default);\n}`, `54885321550953450000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IStarWarsClient</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IOperationResult<span class=\"token punctuation\">&lt;</span>IGetFoo<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">GetFooAsync</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">CancellationToken</span> cancellationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The named operation <code class=\"language-text\">getFoo</code> has become the method <code class=\"language-text\">GetFooAsync</code> in our generated client. This is nice since we kind of control from our GraphQL document the shape of our C# API. But there is more to that. A query document can hold multiple named operations. In essence the query document describes the interface between the client and the server.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"76619299860587630000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query function_a {\n  ...\n}\n\nquery function_b {\n  ...\n}\n\nquery function_c {\n  ...\n}`, `76619299860587630000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> function_a <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">query</span> function_b <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">query</span> function_c <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Since, with GraphQL you essentially design your own service API by writing a query document you want to have control over the structure of your generated types. <em>Strawberry Shake</em> uses fragments to help you describe clean and reusable code components.</p>\n<p>Let us redesign our query with fragments and make it a bit more complex.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"43519212668702560000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query getHero {\n  hero {\n    ...SomeDroid\n    ...SomeHuman\n  }\n}\n\nfragment SomeHuman on Human {\n  ...HasName\n  homePlanet\n}\n\nfragment SomeDroid on Droid {\n  ...HasName\n  primaryFunction\n}\n\nfragment HasName on Character {\n  name\n}`, `43519212668702560000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getHero <span class=\"token punctuation\">{</span>\n  hero <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeDroid</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeHuman</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeHuman</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Human</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  homePlanet\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeDroid</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Droid</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  primaryFunction\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">HasName</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Character</span> <span class=\"token punctuation\">{</span>\n  name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The fragments will yield in the following type structure:</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"67173326049506410000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface ISomeHuman\n    : IHasName\n{\n    string HomePlanet { get; }\n}\n\npublic interface ISomeDroid\n    : IHasName\n{\n    string PrimaryFunction { get; }\n}\n\npublic interface IHasName\n{\n    string Name { get; }\n}`, `67173326049506410000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ISomeHuman</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">IHasName</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> HomePlanet <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ISomeDroid</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">IHasName</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> PrimaryFunction <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IHasName</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> Name <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let us reflect on that, fragments not only let us re-use type selections in our query document but also let us create and mold our C# API into a clean type structure. This puts us as the consumer of <em>Strawberry Shake</em> in the driver seat.</p>\n<p><strong>We</strong> decide what data we <strong>need</strong> and how they are <strong>shaped</strong>.</p>\n<blockquote>\n<p>We are currently looking into how we can aggregate data and flatten the type structure. We initially thought about introducing some directives to flatten the type structure. But as we thought further on that and we really felt we want to have something like <a href=\"https://github.com/APIs-guru/graphql-lodash\">lodash</a>. We are still discussing on what we want to do here. So stay tuned.</p>\n</blockquote>\n<p>Let's make one more tweak to our query and then we get this example running.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"26868695036454793000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query getHero(\\$episode: Episode) {\n  hero(episode: \\$episode) {\n    ...SomeDroid\n    ...SomeHuman\n  }\n}\n\nfragment SomeHuman on Human {\n  ...HasName\n  homePlanet\n}\n\nfragment SomeDroid on Droid {\n  ...HasName\n  primaryFunction\n}\n\nfragment HasName on Character {\n  name\n}`, `26868695036454793000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getHero<span class=\"token punctuation\">(</span><span class=\"token variable\">$episode</span><span class=\"token punctuation\">:</span> Episode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  hero<span class=\"token punctuation\">(</span><span class=\"token attr-name\">episode</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$episode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeDroid</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeHuman</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeHuman</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Human</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  homePlanet\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeDroid</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Droid</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  primaryFunction\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">HasName</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Character</span> <span class=\"token punctuation\">{</span>\n  name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>By defining a variable with our operation we now can pass in arguments. This makes our operation re-usable and a good interface with the server. GraphQL servers can pre-compile and optimize those parametrized query documents.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"22172508760663680000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface IStarWarsClient\n{\n    Task<IOperationResult<IGetHero>> GetHeroAsync(\n        Optional<Episode> episode = default,\n        CancellationToken cancellationToken = default);\n}`, `22172508760663680000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IStarWarsClient</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IOperationResult<span class=\"token punctuation\">&lt;</span>IGetHero<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">GetHeroAsync</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">Optional<span class=\"token punctuation\">&lt;</span>Episode<span class=\"token punctuation\">></span></span> episode <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">CancellationToken</span> cancellationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>OK, let's get it running and then go into more details.</p>\n<p>By default the generator will also generate dependency injection code for <code class=\"language-text\">Microsoft.Extensions.DependencyInjection</code>.</p>\n<p>In order to get our client up and running we just have to set up a dependency injection container.</p>\n<blockquote>\n<p>Note: You can shut off dependency injection generation with a <em>MSBuild</em> property. The client can also be instantiated with a builder or by using a different dependency injection container.</p>\n</blockquote>\n<p>Replace your <code class=\"language-text\">Program</code> class with the following code.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"23148671131794285000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`class Program\n{\n    static async Task Main(string[] args)\n    {\n        var serviceCollection = new ServiceCollection();\n        serviceCollection.AddHttpClient(\n            &quot;StarWarsClient&quot;,\n            c => c.BaseAddress = new Uri(&quot;http://localhost:5000/graphql&quot;));\n        serviceCollection.AddStarWarsClient();\n\n        IServiceProvider services = serviceCollection.BuildServiceProvider();\n        IStarWarsClient client = services.GetRequiredService<IStarWarsClient>();\n\n        IOperationResult<IGetHero> result = await client.GetHeroAsync(Episode.Newhope);\n        Console.WriteLine(((ISomeDroid)result.Data.Hero).Name);\n\n        result = await client.GetHeroAsync(Episode.Empire);\n        Console.WriteLine(((ISomeHuman)result.Data.Hero).Name);\n    }\n}`, `23148671131794285000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Program</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task</span> <span class=\"token function\">Main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> args<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> serviceCollection <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ServiceCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">AddHttpClient</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"StarWarsClient\"</span><span class=\"token punctuation\">,</span>\n            c <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>BaseAddress <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:5000/graphql\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">AddStarWarsClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">IServiceProvider</span> services <span class=\"token operator\">=</span> serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">BuildServiceProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">IStarWarsClient</span> client <span class=\"token operator\">=</span> services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IStarWarsClient<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">IOperationResult<span class=\"token punctuation\">&lt;</span>IGetHero<span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetHeroAsync</span><span class=\"token punctuation\">(</span>Episode<span class=\"token punctuation\">.</span>Newhope<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ISomeDroid<span class=\"token punctuation\">)</span>result<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>Hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetHeroAsync</span><span class=\"token punctuation\">(</span>Episode<span class=\"token punctuation\">.</span>Empire<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ISomeHuman<span class=\"token punctuation\">)</span>result<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>Hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Run the console and it will output the following;</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"41499202406819950000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`R2-D2\nLuke Skywalker`, `41499202406819950000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">R2-D2\nLuke Skywalker</code></pre></div>\n<p>That is quite awesome. The client is easy to setup and easy to use. We just had to initialize our project and write a GraphQL query document and everything was generated so that we can focus on using our GraphQL endpoint instead of writing a bunch of code that we do not want to actually write. Moreover, we only get the types from the schema that we actually use in our query documents, that means we are not burdened with all the schema types and fields and so on that we do not need and do not want.</p>\n<p><em>Strawberry Shake</em> let`s you take all the power of GraphQL and package it up into a fully typed client that works well with .NET. It does not limit you by introducing a new programming model like Linq or some other .NET API, instead <em>Strawberry Shake</em> makes <strong>GraphQL a first class citizen in the .NET world</strong>.</p>\n<p>OK, now let us have a look at the result object since we also carefully discussed how we expose results to the consumer.</p>\n<p>The result of an operation can be a <code class=\"language-text\">IOperationResult&lt;T&gt;</code> or a <code class=\"language-text\">IResponseStream&lt;T&gt;</code>.</p>\n<p>The operation result represents a single result and we expose the GraphQL result structure as specified in the GraphQL spec.</p>\n<p>This means that we give you a chance to take advantage of partial results in case of errors. However, we also make it easy to raise an exception in case of any error with the <code class=\"language-text\">EnsureNoErrors</code> method on the result object. This is kind of like with responses from a <code class=\"language-text\">HttpClient</code>.</p>\n<p>Also, we allow you to have full access to provider specific data that is included in a dictionary called <code class=\"language-text\">Extensions</code>. This for instances is used in cases like active persisted queries or other provider specific extensions.</p>\n<h2 id=\"renaming-type-elements\" style=\"position:relative;\"><a href=\"#renaming-type-elements\" aria-label=\"renaming type elements permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Renaming Type Elements</h2>\n<p>Did you notice the enum type <code class=\"language-text\">Episode.Newhope</code> in the upper example. This really is not nice to see as a C# developer :). Since the generator is built on top of the stitching API we easily can amend things like that in order to make our client API nice to use.</p>\n<p>So, before we go into subscriptions let`s fix that :)</p>\n<p>First, add another GraphQL file and call it <code class=\"language-text\">StarWars.Extensions.graphql</code>. Again, the name does not really matter, you could call it <code class=\"language-text\">Foo.graphql</code> and <em>Strawberry Shake</em> would also handle it correctly.</p>\n<p>GraphQL allows to extend types with the <code class=\"language-text\">extend</code> keyword in the GraphQL SDL. In the example below we extend the <code class=\"language-text\">Episode</code> enum and add a directive (annotation) called <code class=\"language-text\">@name</code>. The <code class=\"language-text\">@name</code> directive allows us to provide the generator with a name for a type element that we actually want to use in our C# client API.</p>\n<p>Now add the following type extension to the GraphQL file <code class=\"language-text\">StarWars.Extensions.graphql</code>:</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"50297413102200996000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`extend enum Episode {\n  NEWHOPE @name(value: &quot;NewHope&quot;)\n}`, `50297413102200996000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">extend</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Episode</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">NEWHOPE</span> <span class=\"token directive function\">@name</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"NewHope\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Rebuild your project and voila ... <code class=\"language-text\">Episode.NewHope</code> is now correctly cased.</p>\n<p>The nice thing is that we are just describing what we want to change in this schema extension file, so every time you update the server schema, we will preserve this file and reapply the type extensions to the newly downloaded schema.</p>\n<h2 id=\"subscriptions\" style=\"position:relative;\"><a href=\"#subscriptions\" aria-label=\"subscriptions permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a> Subscriptions</h2>\n<p>OK, OK, most of this was already in place, so let us have a look at something more challenging like subscriptions.</p>\n<p>Subscriptions will need a state-full connection to a server through a WebSocket. There are other ways to do this like SignalR (which essentially is a socket abstraction) or gRPC or even over a standard TCP socket.</p>\n<p>While we are in the works to get SignalR and gRPC in let us have a look at how we can do it through WebSockets.</p>\n<p>When we started on this we found that WebSockets should be as easy as setting up the HttpClient nowadays. So, we have introduced a new interface called <code class=\"language-text\">IWebSocketClientFactory</code>. But just having a factory is not enough since we want to maybe pool socket connections and reuse those with multiple subscriptions.</p>\n<p>With the solution that we are introducing with version 11.0.0-preview.58 we are making WebSockets super simple to setup, and we will do all the hard parts like reusing the connection and things like that without you ever noticing it.</p>\n<p>Let us have a look at how we can get subscriptions to work.</p>\n<p>The first thing we have to do is going back to our query document. The <em>Star Wars</em> server has one subscription that is raised whenever a review is written. So, let’s use it and add it to our query file.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"21030579468230970000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`query getHero(\\$episode: Episode!) {\n  hero(episode: \\$episode) {\n    ...SomeDroid\n    ...SomeHuman\n  }\n}\n\nsubscription onReviewCreated(episode: \\$episode) {\n  onReview(episode: \\$episode) {\n    commentary\n    stars\n  }\n}\n\nfragment SomeHuman on Human {\n  ...HasName\n  homePlanet\n}\n\nfragment SomeDroid on Droid {\n  ...HasName\n  primaryFunction\n}\n\nfragment HasName on Character {\n  name\n}`, `21030579468230970000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getHero<span class=\"token punctuation\">(</span><span class=\"token variable\">$episode</span><span class=\"token punctuation\">:</span> Episode<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  hero<span class=\"token punctuation\">(</span><span class=\"token attr-name\">episode</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$episode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeDroid</span>\n    <span class=\"token operator\">...</span><span class=\"token fragment function\">SomeHuman</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">subscription</span> onReviewCreated<span class=\"token punctuation\">(</span><span class=\"token attr-name\">episode</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$episode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  onReview<span class=\"token punctuation\">(</span><span class=\"token attr-name\">episode</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$episode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    commentary\n    stars\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeHuman</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Human</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  homePlanet\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">SomeDroid</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Droid</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token fragment function\">HasName</span>\n  primaryFunction\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fragment</span> <span class=\"token fragment function\">HasName</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Character</span> <span class=\"token punctuation\">{</span>\n  name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, lets rebuild our project and then look at the client interface.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"31218993430871510000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public interface IStarWarsClient\n{\n    Task<IOperationResult<IGetHero>> GetHeroAsync(\n        Optional<Episode> episode = default,\n        CancellationToken cancellationToken = default);\n\n    Task<IResponseStream<IOnReviewCreated>> OnReviewCreatedAsync(\n        Optional<Episode> episode = default,\n        CancellationToken cancellationToken = default);\n}`, `31218993430871510000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IStarWarsClient</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IOperationResult<span class=\"token punctuation\">&lt;</span>IGetHero<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">GetHeroAsync</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">Optional<span class=\"token punctuation\">&lt;</span>Episode<span class=\"token punctuation\">></span></span> episode <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">CancellationToken</span> cancellationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>IResponseStream<span class=\"token punctuation\">&lt;</span>IOnReviewCreated<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">OnReviewCreatedAsync</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">Optional<span class=\"token punctuation\">&lt;</span>Episode<span class=\"token punctuation\">></span></span> episode <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">CancellationToken</span> cancellationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our client has now a new method that returns a response stream. A response stream is essentially an <code class=\"language-text\">IAsyncEnumerable</code> that will loop over the subscription event stream until the stream completes or the client disposes the stream.</p>\n<p>Now let us put everything together. First we need to configure the WebSocket client connection.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"63841281520226500000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`services.AddWebSocketClient(\n    &quot;StarWarsClient&quot;,\n    c => c.Uri = new Uri(&quot;ws://localhost:5000/graphql&quot;));`, `63841281520226500000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token function\">AddWebSocketClient</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"StarWarsClient\"</span><span class=\"token punctuation\">,</span>\n    c <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>Uri <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ws://localhost:5000/graphql\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This kind of looks exactly the way we would configure an HttpClient and it hides all the complex logic about connecting and pooling WebSocket connections. It also lets you easily intercept the connect process to include authentication logic.</p>\n<p>The next thing we need to do to consume data from subscriptions is to read from our event stream.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"81739416614505220000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`class Program\n{\n    static async Task Main(string[] args)\n    {\n        var serviceCollection = new ServiceCollection();\n        serviceCollection.AddHttpClient(\n            &quot;StarWarsClient&quot;,\n            c => c.BaseAddress = new Uri(&quot;http://localhost:5000/graphql&quot;));\n        serviceCollection.AddStarWarsClient();\n\n        IServiceProvider services = serviceCollection.BuildServiceProvider();\n        IStarWarsClient client = services.GetRequiredService<IStarWarsClient>();\n\n        var stream = await client.OnReviewCreatedAsync(Episode.NewHope);\n\n        await foreach (var result in stream)\n        {\n            result.EnsureNoErrors();\n            Console.WriteLine(result.Data!.OnReview.Commentary);\n        }\n    }\n}`, `81739416614505220000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Program</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task</span> <span class=\"token function\">Main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> args<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> serviceCollection <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ServiceCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">AddHttpClient</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"StarWarsClient\"</span><span class=\"token punctuation\">,</span>\n            c <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>BaseAddress <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:5000/graphql\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">AddStarWarsClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">IServiceProvider</span> services <span class=\"token operator\">=</span> serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">BuildServiceProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">IStarWarsClient</span> client <span class=\"token operator\">=</span> services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IStarWarsClient<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> stream <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">OnReviewCreatedAsync</span><span class=\"token punctuation\">(</span>Episode<span class=\"token punctuation\">.</span>NewHope<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token keyword\">in</span> stream<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">EnsureNoErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>Data<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>OnReview<span class=\"token punctuation\">.</span>Commentary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you look at the code above it looks so easy how you can use subscription with <em>Strawberry Shake</em>, it almost looks no different from fetching a simple query with the <code class=\"language-text\">HttpClient</code>. This is exactly what we want the experience to be, simple but when you want to get into the pluming then we will allow you to easily intercept and extend the whole pipeline.</p>\n<p>So, in order to try subscriptions out in your example open a tool like playground and the fire the following query against the local GraphQL Server while your console app is running.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"90015048737360640000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`mutation {\n  createReview(\n    episode: NEWHOPE\n    review: { commentary: &quot;Awesome movie.&quot;, stars: 5 }\n  ) {\n    commentary\n    stars\n  }\n}`, `90015048737360640000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">mutation</span> <span class=\"token punctuation\">{</span>\n  createReview<span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">episode</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">NEWHOPE</span>\n    <span class=\"token attr-name\">review</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">commentary</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Awesome movie.\"</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">stars</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    commentary\n    stars\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As soon as you trigger the above mutation the client will print the commentary to the console, it is kind of like magic :)</p>\n<h2 id=\"custom-scalars\" style=\"position:relative;\"><a href=\"#custom-scalars\" aria-label=\"custom scalars permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Custom Scalars</h2>\n<p>The mean thing with all these examples that I posted in this blog is that I am only using the <em>Star Wars</em> example. The <em>Star Wars</em> uses no custom scalars and is super simple to use. That is the reason why I like to use it for demos, because people get easily on board with it. But it also is frustrating when you want to go deeper. This is especially true with custom scalars.</p>\n<p><em>Strawberry Shake</em> supports an array of built-in scalars that go beyond the GraphQL spec. But still if you download the GitHub schema for instance you will get a ton of custom scalars.</p>\n<p>With the current version we have made dealing with custom scalars a lot easier. First, if we do not know a scalar, then we will treat it as a <code class=\"language-text\">String</code>. While this is not always what you want, it lets you get started quickly and then change things when you really need them to change.</p>\n<p>Let us have a look at how we can bring in a custom scalar. For this example, let us assume we have a scalar called <code class=\"language-text\">ByteArray</code>. This scalar serializes a <code class=\"language-text\">System.Byte[]</code> to a base64 string. This is easy enough. So on the client side we want the generator to generate models that expose <code class=\"language-text\">System.Byte[]</code> as property type. But in the communication between server and client the type shall be serialized as base64 string.</p>\n<p>So, in order to give the generator a hint about these things we need to extend our schema. We would need to create a GraphQL file that holds our schema extensions (basically like with the enum example, where we renamed the enum value). The same way we can extend enums we can extend other types. In this case we want to annotate a scalar type.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"92921374496669710000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`extend scalar ByteArray\n@runtimeType(name: &quot;System.Byte[]&quot;)\n@serializationType(name: &quot;System.String&quot;)`, `92921374496669710000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">extend</span> <span class=\"token keyword\">scalar</span> <span class=\"token class-name\">ByteArray</span>\n<span class=\"token directive function\">@runtimeType</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"System.Byte[]\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token directive function\">@serializationType</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"System.String\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The above example declares that for the <code class=\"language-text\">ByteArray</code> scalar the runtime type (the type that is used in the C# models) shall be a <code class=\"language-text\">System.Byte[]</code> and that the serialization type (the type which client and server use to send the data) shall be a <code class=\"language-text\">System.String</code>. For the generator that is enough to generate everything accordingly.</p>\n<p>We still have to implement an <code class=\"language-text\">IValueSerializer</code> to specify the logic how the type shall actually serialize and deserialize.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"1094651658389600400\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class ByteArrayValueSerializer\n    : ValueSerializerBase<byte[], string>\n{\n    public override string Name => &quot;ByteArray&quot;;\n\n    public override ValueKind Kind => ValueKind.String;\n\n    public override object? Serialize(object? value)\n    {\n        if (value is null)\n        {\n            return null;\n        }\n\n        if (value is byte[] b)\n        {\n            return Convert.ToBase64String(b);\n        }\n\n        throw new ArgumentException(\n            &quot;The specified value is of an invalid type. &quot; +\n            \\$&quot;{ClrType.FullName} was expeceted.&quot;);\n    }\n\n    public override object? Deserialize(object? serialized)\n    {\n        if (serialized is null)\n        {\n            return null;\n        }\n\n        if (serialized is string s)\n        {\n            return Convert.FromBase64String(s);\n        }\n\n        throw new ArgumentException(\n            &quot;The specified value is of an invalid type. &quot; +\n            \\$&quot;{SerializationType.FullName} was expeceted.&quot;);\n    }\n}`, `1094651658389600400`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ByteArrayValueSerializer</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">ValueSerializerBase<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> Name <span class=\"token operator\">=></span> <span class=\"token string\">\"ByteArray\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\">ValueKind</span> Kind <span class=\"token operator\">=></span> ValueKind<span class=\"token punctuation\">.</span>String<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">object</span><span class=\"token punctuation\">?</span></span> <span class=\"token function\">Serialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span><span class=\"token punctuation\">?</span></span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span> <span class=\"token keyword\">is</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span> <span class=\"token keyword\">is</span> <span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> b<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> Convert<span class=\"token punctuation\">.</span><span class=\"token function\">ToBase64String</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ArgumentException</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"The specified value is of an invalid type. \"</span> <span class=\"token operator\">+</span>\n            <span class=\"token interpolation-string\"><span class=\"token string\">$\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">ClrType<span class=\"token punctuation\">.</span>FullName</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> was expeceted.\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">object</span><span class=\"token punctuation\">?</span></span> <span class=\"token function\">Deserialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span><span class=\"token punctuation\">?</span></span> serialized<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>serialized <span class=\"token keyword\">is</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>serialized <span class=\"token keyword\">is</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> s<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> Convert<span class=\"token punctuation\">.</span><span class=\"token function\">FromBase64String</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ArgumentException</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"The specified value is of an invalid type. \"</span> <span class=\"token operator\">+</span>\n            <span class=\"token interpolation-string\"><span class=\"token string\">$\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">SerializationType<span class=\"token punctuation\">.</span>FullName</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> was expeceted.\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The serializer can be added as a singleton and will be automatically integrated by the generated client.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"50116377295061130000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`services.AddSingleton<IValueSerializer, ByteArrayValueSerializer>();`, `50116377295061130000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IValueSerializer<span class=\"token punctuation\">,</span> ByteArrayValueSerializer<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>We are refining how those serializers are registered. This is important for cases where one wants to have multiple clients with different kinds of serializers. I know this is rare but still this should work. The coming versions of <em>Strawberry Shake</em> will fine tune this.</p>\n</blockquote>\n<h2 id=\"digging-deeper\" style=\"position:relative;\"><a href=\"#digging-deeper\" aria-label=\"digging deeper permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Digging Deeper</h2>\n<p>Apart from being able to add custom scalars we might want to dig deeper and allow new scenarios with our client like persisted queries. It is needles to say that we will add persisted query support out of the box. But it is also a good example to use to show how we can enable advance server / client protocols with <em>Strawberry Shake</em>.</p>\n<p>The way we built-in things like that is by providing a operation middleware. This basically works like the query middleware in the server on the request level.</p>\n<p><em>Strawberry Shake</em> allows us to swap out the default operation execution pipeline and add our own custom operation execution pipeline.</p>\n<p>In order to setup a custom operation execution pipeline you can use for instance the <code class=\"language-text\">HttpPipelineBuilder</code>. Each transport has it`s own transport specific pipeline since the protocol between socket communication and stateless communication is quite different.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"29656932196410122000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`serviceCollection.AddSingleton<OperationDelegate>(\n    sp => HttpPipelineBuilder.New()\n        .Use<CreateStandardRequestMiddleware>()\n        .Use<CustomMiddleware>()\n        .Use<SendHttpRequestMiddleware>()\n        .Use<ParseSingleResultMiddleware>()\n        .Build(sp));`, `29656932196410122000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">serviceCollection<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>OperationDelegate<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>\n    sp <span class=\"token operator\">=></span> HttpPipelineBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Use</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>CreateStandardRequestMiddleware<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Use</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>CustomMiddleware<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Use</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>SendHttpRequestMiddleware<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Use</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>ParseSingleResultMiddleware<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">Build</span><span class=\"token punctuation\">(</span>sp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"23523676005367644000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`public class CustomMiddleware\n{\n    private readonly OperationDelegate _next;\n    private readonly IOperationSerializer _service;\n\n    public CustomMiddleware(\n        OperationDelegate next,\n        ISomeCustomService service)\n    {\n        _next = next ?? throw new ArgumentNullException(nameof(next));\n        _service = service ?? throw new ArgumentNullException(nameof(service));\n    }\n\n    public async Task InvokeAsync(IHttpOperationContext context)\n    {\n        // the custom middleware code\n        await _next(context);\n    }\n}`, `23523676005367644000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomMiddleware</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">OperationDelegate</span> _next<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">IOperationSerializer</span> _service<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">CustomMiddleware</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">OperationDelegate</span> next<span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">ISomeCustomService</span> service<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        _next <span class=\"token operator\">=</span> next <span class=\"token operator\">??</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">nameof</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        _service <span class=\"token operator\">=</span> service <span class=\"token operator\">??</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ArgumentNullException</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">nameof</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task</span> <span class=\"token function\">InvokeAsync</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IHttpOperationContext</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// the custom middleware code</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">_next</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"generation-options\" style=\"position:relative;\"><a href=\"#generation-options\" aria-label=\"generation options permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Generation Options</h2>\n<p>By default <em>Strawberry Shake</em> generates dependency injection code for <code class=\"language-text\">Microsoft.Extensions.DependencyInjection</code> this can be switched of by adding the following <code class=\"language-text\">MSBuild</code> property <code class=\"language-text\">&lt;GraphQLEnableDI&gt;false&lt;/GraphQLEnableDI&gt;</code>.</p>\n<p>The generator will automatically detect if you are using C# 8.0 with nullable reference types or if you are using an older version of C#.</p>\n<p>You can use the following <code class=\"language-text\">MSBuild</code> properties to control this.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"92749626684929360000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<PropertyGroup>\n  <LangVersion>8.0</LangVersion>\n  <Nullable>enable</Nullable>\n</PropertyGroup>`, `92749626684929360000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LangVersion</span><span class=\"token punctuation\">></span></span>8.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LangVersion</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Nullable</span><span class=\"token punctuation\">></span></span>enable<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Nullable</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PropertyGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>We also by default take the root namespace from the project for generating files. You can however override this by providing the <code class=\"language-text\">&lt;BerryNamespace /&gt;</code> property. However, we will change this to an item group soon in order to also enable multiple clients in a single project to use different namespaces.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"74417553031371720000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied code example\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<PropertyGroup>\n  <BerryNamespace>\\$(RootNamespace)</BerryNamespace>\n</PropertyGroup>`, `74417553031371720000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"Copy\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>BerryNamespace</span><span class=\"token punctuation\">></span></span>$(RootNamespace)<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>BerryNamespace</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PropertyGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"dependency-injection\" style=\"position:relative;\"><a href=\"#dependency-injection\" aria-label=\"dependency injection permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Dependency Injection</h2>\n<p>The client API can be used with other dependency injection container and also without dependency injection at all.</p>\n<p>We initially had a limited builder API for this but decided to give it a do over. So, at the moment you could look at the generated dependency injection code and build your own integration.</p>\n<p>We will allow with future build to add custom generators that can provide additional code for custom use cases. The way that would work is that such a generator would sit in a NuGet package that is being added to the project. The custom generator would register its generators to an item group and <em>Strawberry Shake</em> would pick those up and integrate them. These custom generators however are somewhere in the version 12 timeframe.</p>\n<h2 id=\"roadmap\" style=\"position:relative;\"><a href=\"#roadmap\" aria-label=\"roadmap permalink\" class=\"anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" width=\"16\" height=\"16\"><path d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"/></svg></a>Roadmap</h2>\n<p>What are our next steps on <em>Strawberry Shake</em> and when are we planning to release it?</p>\n<p>We have some more ground to cover before we have this version complete.</p>\n<ol>\n<li>MSBuild Integration\nWe are working on making the <em>MSBuild</em> integration better. There are still instances with <em>VSCode</em> where you have to compile twice. This is OK for a preview,but we are on it and think that in the next view preview builds we will have this fixed. With <em>Visual Studio for Windows</em> you can already enjoy design time code generation. This means that when you save a GraphQL file the generator will update the C# files.</li>\n<li>\n<p>Tooling\nWe are heavy at work on <em>Bananacake Pop</em> which is our GraphQL IDE that will help you write and analyze GraphQL queries.\nWe plan to use what we have done for <em>Bananacake Pop</em> to create a nice integration with <em>VSCode</em>. We want to have a rich integration with which you can work on huge schemas.</p>\n<p>Beyond <em>VSCode</em> we are looking at writing a nice integration with <em>Visual Studio for Windows</em> and <em>Visual Studio for macOS</em> that will make <em>Strawberry Shake</em> and <em>GraphQL</em> a first-class citizen in Microsoft IDEs.</p>\n<p>We hope to deliver all of this in the version 11 timeframe.</p>\n</li>\n<li>Persisted Query Support\nPersisted queries are one of our very next features that we will add to the client. We want to allow the same flows that we support on the server side.</li>\n<li>Batching Support\nBatching support with the <code class=\"language-text\">@export</code> directive is as well planned for the initial release of <em>Strawberry Shake</em>.</li>\n<li>Code Generation\nThe current code generation produces quite nice code, but it can produce issues where the types from your own project collide with the generated code. With the next view builds we will add an option to use full type names in those cases.\nAlso, we will add the code generation attribute to the generated files. So there are refinements going on in this area.</li>\n<li>Defer / Stream\nWe are planning to add support for defer and stream to the client. This feature depends on our server implementation so we will have to see how far we are on execution plans before we can start on it for the client.</li>\n</ol>\n<p>I hope you enjoy what we are building. We are tying to bring GraphQL on .NET to the next level. While we still are miles away from what the JavaScript world has to offer we hope to close these gaps over the next year and even pull ahead in some areas. We love GraphQL and are passionate about it. We strongly believe that with our newest member <em>Strawberry Shake</em> we really can make things like <em>Xamarin</em> and <em>Blazor</em> so much better. We have planned a lot more and hope to bring data fetching in .NET to a whole new level over the next year. Ideally you just want to decalre in your .NET component the data that you need and all the client logic is infered from that, kind of the way relay works in JavaScript.</p>\n<p>If you want to get into contact with us head over to our <a href=\"https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTViMzA2MTM4OWYwYjIxYzViYmM0YmZhYjdiNzBjOTg2ZmU1YmMwNDZiYjUyZWZlMzNiMTk1OWUxNWZhMzQwY2Q\">slack channel</a> and join our community.</p>","fields":{"readingTime":{"text":"21 min read"}}},"site":{"siteMetadata":{"siteUrl":"https://chillicream.com","author":"Chilli_Cream"}}},"pageContext":{}},"staticQueryHashes":["2890364758","4218812017","63159454"]}